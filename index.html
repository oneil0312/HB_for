<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>靖彤生日倒數計時器</title>
  <link rel="stylesheet" href="styles.css">  
</head>
<body>

<section id="countdown">
  <h1>靖彤 정동 Avery 生日倒數計時器</h1>
  <div id="digital-clock">
    <div class="digit">
      <span class="digit-label">天</span>
      <span id="days" class="digit-value">00</span>
    </div>
    <div class="digit">
      <span class="digit-label">時</span>
      <span id="hours" class="digit-value">00</span>
    </div>
    <div class="digit">
      <span class="digit-label">分</span>
      <span id="minutes" class="digit-value">00</span>
    </div>
    <div class="digit">
      <span class="digit-label">秒</span>
      <span id="seconds" class="digit-value">00</span>
    </div>
  </div>

  <div id="warning-button">
    <button id="count-button" class="warning-btn">沒用按鈕次數: <span id="click-count">0</span></button>    
  </div>
  
  <div class="calendar-container">
    <img src="December.png" alt="Calendar" class="calendar-image">
    <div class="date-circle"></div> <!-- 紅色圓圈 -->
  </div>
  
  <img src="causon_bread.png" alt="causon_bread" class="causon_bread" onclick="playSound()">
  <audio id="clickSound">
    <source src="causon.mp3" type="audio/mpeg">
  </audio>
  
  <img src="causon.png" alt="causon" class="causon" id="causonImage" style="display: none;">  
  
  
<section class="level-selector">
  <div class="level-card" onclick="showGame(1)">
    <h2>關卡 1</h2>
    <img src="level1.png" alt="Level 1" />
  </div>

  <div class="level-card" id="level-2" onclick="checkLevel2Access()">
    <h2>關卡 2</h2>
    <img src="level2.png" alt="Level 2" />
    <p id="level2-countdown">還剩 <span id="level2-days">3</span> 天 開啟</p> <!-- 倒數計時顯示 -->
  </div>

  <div class="level-card" onclick="showGame(3)">
    <h2>關卡 3</h2>
    <img src="level3.png" alt="Level 3" />
  </div>
</section>

<div id="hint-message" style="display: none;">今天的提示字是: <span id="hint-word">Re</span>。</div>

<!-- 三個不同的遊戲區域 -->
<section id="game1" class="game-area">
  <section id="game-section">
    <h2 class="game-title-modern"><span>音樂</span> 消消樂</h2>

    <p class="score-display">分數: <span id="score">0</span></p> <!-- 顯示分數 -->

    <div id="memory-game" class="memory-game">
      <!-- 這裡的卡片將通過 JavaScript 動態生成 -->
    </div>

    <label for="volumeControl">音量:</label>
    <input type="range" id="volumeControl" min="0" max="1" step="0.01" value="0.1">
    <button id="restart-button" class="restart-btn" style="display: none;">重新開始遊戲</button>
  </section>

  <div id="message-container" style="display: none;">
    <p id="message-text"></p>
    <button id="close-button">確認</button>
  </div>
</section>

<section id="game2" class="game-area" style="display: none;">
  <h3>這是關卡 2 的遊戲區域</h3>
  <!-- 加入關卡 2 的遊戲內容 -->
</section>

<section id="game3" class="game-area" style="display: none;">
  <h3>這是關卡 3 的遊戲區域</h3>
  <!-- 加入關卡 3 的遊戲內容 -->
</section>

<div style="text-align: center;">
  <a href="HB_for_avery.html">
    <img id="birthday-image" src="https://static.wikia.nocookie.net/minecraft_zh_gamepedia/images/0/03/Nether_portal_%28animated%29.png/revision/latest/scale-to-width-down/250?cb=20200830042435" alt="Birthday Image" style="display: none;">
  </a>
</div>


<script>
// 當點擊 causon_bread 時執行的函數
function playSound() {
  var audio = document.getElementById("clickSound");
  audio.volume = 0.3;
  audio.play();

  // 顯示 causon.png 圖片並啟動動畫
  var causonImage = document.getElementById("causonImage");
  causonImage.style.display = 'block';  // 顯示圖片
  causonImage.classList.add('animate');  // 添加動畫效果

  // 在動畫結束後將圖片隱藏
  setTimeout(function() {
    causonImage.style.display = 'none';  // 重新隱藏圖片
    causonImage.classList.remove('animate');  // 移除動畫效果以便下一次重新執行
  }, 3000); // 3秒後隱藏圖片
}

function checkLevel2Access() {
  var days = parseInt(document.getElementById('days').textContent);
  if (days < 3) {
    showGame(2); // 顯示第二關
  } else {
    alert("第二關尚未開啟，請稍後再試！");
  }
}

// 倒數日期
var countdownDate = new Date('2024-10-23').getTime();
var clickCount = 0; // 點擊計數器
var secondPhaseOpened = false; // 記錄第二關是否已開啟

// 更新倒數計時器
function updateCountdown() {
  var now = new Date().getTime();
  var distance = countdownDate - now;

  var days = Math.floor(distance / (1000 * 60 * 60 * 24));
  var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
  var seconds = Math.floor((distance % (1000 * 60)) / 1000);

  // 更新數字顯示
  document.getElementById('days').textContent = padZero(days);
  document.getElementById('hours').textContent = padZero(hours);
  document.getElementById('minutes').textContent = padZero(minutes);
  document.getElementById('seconds').textContent = padZero(seconds);

  // 倒數結束時顯示生日圖片
  if (distance <= 0) {
    clearInterval(countdownInterval);
    document.getElementById('birthday-image').style.display = 'block';
  } else if (days < 2) {
    showCatAnimation();
  }
// 更新關卡2中的倒數顯示，並將days減去2
  var remainingDays = days - 2;
  document.getElementById('level2-countdown').textContent = `還剩 ${remainingDays} 天 開啟`;
  // 當剩餘時間小於三天時開啟第二關
  console.log("Days until birthday: " + days); // 日誌輸出
  if (days < 3 && !secondPhaseOpened) {
    secondPhaseOpened = true; // 設置為已開啟
    document.getElementById('level-2').style.display = 'block'; // 顯示第二關內容
    // 隱藏關卡2中的倒數顯示
    document.getElementById('level2-countdown').style.display = 'none';
    console.log("Second phase opened!"); // 日誌輸出
  }
}

// 輔助函數：補零
function padZero(num) {
  return num < 10 ? '0' + num : num;
}

// 開始倒數計時
var countdownInterval = setInterval(updateCountdown, 1000);

// 更新點擊計數並顯示對話框
document.getElementById("count-button").addEventListener("click", function() {
  clickCount++;
  document.getElementById("click-count").textContent = clickCount;

  if (clickCount >= 100) {
    alert("恭喜你離生日又更近一點了!");
    clickCount = 0; // 重新歸零
    document.getElementById("click-count").textContent = clickCount; // 更新顯示
  }
});

function showCatAnimation() {
  var catImage = document.createElement('img');
  catImage.src = 'https://img.cgmodel.com/image/2020/0627/big/38830-614463665.gif';
  catImage.style.width = '150px';
  catImage.style.position = 'fixed';
  catImage.style.bottom = '20px';
  catImage.style.left = '-100px';
  catImage.style.animation = 'run-animation 5s linear forwards';
  document.body.appendChild(catImage);
  catImage.addEventListener('animationend', function() {
    catImage.remove();
  });
}

// 顯示特定遊戲
function showGame(gameNumber) {
  // 隱藏所有遊戲區域
  document.getElementById('game1').style.display = 'none';
  document.getElementById('game2').style.display = 'none';
  document.getElementById('game3').style.display = 'none';
  
  // 顯示對應的遊戲區域
  document.getElementById('game' + gameNumber).style.display = 'block';
}

// 啟動倒數計時器
var countdownInterval = setInterval(updateCountdown, 1000);









// 消消樂歌曲和圖片的對應關係
const songs = [
    { song: 'voice/yuuri_BETELGEUSE.MP3', framework: 'yuuri_BETELGEUSE' },
    { song: 'voice/Aimer_HoshikuzuVenus.MP3', framework: 'Aimer_HoshikuzuVenus' },
    { song: 'voice/Aimer_Kataomoi.MP3', framework: 'Aimer_Kataomoi' },
    { song: 'voice/Aimer_RokutouseinoYoru.MP3', framework: 'Aimer_RokutouseinoYoru' },
    { song: 'voice/Aimer_ShiroiroKagerou.MP3', framework: 'Aimer_ShiroiroKagerou' },
	{ song: 'voice/Spyair_Orange.MP3', framework: 'Spyair_Orange' },
	{ song: 'voice/yuuri_Leo.MP3', framework: 'yuuri_Leo' },
	{ song: 'voice/yoasobi_blue.MP3', framework: 'yoasobi_blue' },
	{ song: 'voice/yoasobi_monster.MP3', framework: 'yoasobi_monster' },
	{ song: 'voice/yorushika_Algernon.MP3', framework: 'yorushika_Algernon' },
	{ song: 'voice/yorushika_Tadakiminohare.MP3', framework: 'yorushika_Tadakiminohare' },
    { song: 'voice/yuuri_DriedFlowers.MP3', framework: 'yuuri_DrideFlowers' }
];

let selectedSongs = [];

// 隨機選擇四組歌曲
function selectSongs() {
    const shuffledSongs = songs.sort(() => 0.5 - Math.random());
    selectedSongs = shuffledSongs.slice(0, 4); // 取前4組
}

// 動態生成卡片
function generateCards() {
    const memoryGame = document.getElementById('memory-game');
    const cardsHtml = selectedSongs.flatMap(song => [
        `<div class="memory-card" data-framework="${song.framework}">
            <img class="front-face" src="IMG/music_img.jpg" alt="${song.framework}" />
            <div class="back-face"></div>
        </div>`,
        `<div class="memory-card" data-framework="${song.framework}">
            <img class="front-face" src="IMG/${song.framework}.jpg" alt="${song.framework}" />
            <div class="back-face"></div>
        </div>`
    ]).join('');
    memoryGame.innerHTML = cardsHtml;
}

// 初始化遊戲
function initGame() {
    selectSongs(); // 選擇新的四首歌曲
    generateCards(); // 根據選擇的歌曲生成卡片
    addCardListeners(); // 添加卡片點擊事件
    shuffle(); // 隨機打亂卡片
}

// 消消樂邏輯
let hasFlippedCard = false;
let lockBoard = false;
let firstCard, secondCard;
let score = 0; // 分數初始化
let audio; // 聲音變數

const volumeControl = document.getElementById('volumeControl'); // 獲取音量控制元素

function flipCard() {
    if (lockBoard) return; // 如果遊戲板被鎖定，則不允許點擊
    if (this === firstCard) return;

    this.classList.add('flipped');

    // 檢查是否點擊的是有音樂的卡片
    const imgElement = this.querySelector('.front-face');
    if (imgElement && imgElement.getAttribute('src').includes('music_img.jpg')) {
        if (audio) {
            audio.pause(); // 如果有正在播放的音樂，則停止
            audio.currentTime = 0; // 重置時間
        }

        // 根據框架名稱選擇對應的音樂
        const selectedSong = selectedSongs.find(song => song.framework === this.dataset.framework);
        if (selectedSong) {
            audio = new Audio(selectedSong.song); // 播放對應音樂
			audio.volume = volumeControl.value; // 使用音量控制條當前值
            audio.play().catch(err => {
                console.error('音樂播放錯誤:', err);  // 捕獲播放錯誤
            });
        }
    }

    if (!hasFlippedCard) {
        hasFlippedCard = true;
        firstCard = this;
        return;
    }

    secondCard = this;

    // 短暫延遲後檢查是否匹配
    setTimeout(checkForMatch, 300); // 增加延遲，讓翻開的卡片更明顯
}

// 監聽音量控制滑動條，動態調整音量
volumeControl.addEventListener('input', function() {
    if (audio) {
        audio.volume = this.value;  // 動態調整音量
    }
});


function checkForMatch() {
    let isMatch = firstCard.dataset.framework === secondCard.dataset.framework;

    if (isMatch) {
        disableCards(); // 鎖定卡片
        // 取得歌曲名稱和歌手名稱
        const selectedSong = selectedSongs.find(song => song.framework === firstCard.dataset.framework);
        
        // 提取歌名和歌手名
        const songName = selectedSong.framework.split('_')[1]; // 提取下劃線後的部分
        const singerName = selectedSong.song.split('/')[1].split('_')[0]; // 從文件名提取歌手名
        
        // 顯示匹配成功的消息
        showMatchMessage(songName, singerName);
        
    } else {
        unflipCards(); // 如果不匹配，則翻回去
    }
}

function showMatchMessage(songName, artist) {
    // 鎖定遊戲板
    lockBoard = true;

    // 創建覆蓋層
    const overlay = document.createElement('div');
    overlay.id = 'overlay';
    overlay.style.position = 'fixed';
    overlay.style.top = '0';
    overlay.style.left = '0';
    overlay.style.width = '100%';
    overlay.style.height = '100%';
    overlay.style.backgroundColor = 'rgba(0, 0, 0, 0.5)'; // 半透明背景
    overlay.style.zIndex = '999'; // 確保在最上面
    document.body.appendChild(overlay);

    const matchMessage = document.createElement('div');
    matchMessage.id = 'match-message';
    matchMessage.innerHTML = `
        <div class="match-message-content">
            <p>🎉 恭喜你答對了!! 🎉</p>
            <p>歌名為: "${songName}"</p>
            <p>歌手為: "${artist}"</p>
            <button id="confirm-button">確認 <span class="small-text">(請等後方卡片消失再按)</span></button>
        </div>
    `;
    document.body.appendChild(matchMessage);

    // 點擊確認按鈕時，關閉提示視窗和覆蓋層
    document.getElementById('confirm-button').addEventListener('click', () => {
        document.body.removeChild(matchMessage); // 移除提示視窗
        document.body.removeChild(overlay); // 移除覆蓋層
        lockBoard = false; // 確認後解鎖遊戲板
        resetBoard(); // 重置翻牌狀態

        // 檢查分數是否達到10分，顯示提示訊息
        if (score === 10) {
            showHintPopup(); // 顯示提示字的彈窗
        }
    });
}

function showHintPopup() {
    // 創建提示彈窗
    const hintPopup = document.createElement('div');
    hintPopup.id = 'hint-popup';
    hintPopup.innerHTML = `
        <div class="hint-popup-content">
            <p> 今天的提示字是: <strong style="color: #ff4081;">RE</strong> </p>
            <button class="hint-confirm-button">確認</button>
        </div>
    `;
    
    document.body.appendChild(hintPopup);

    // 點擊確認按鈕時，關閉提示彈窗
    const confirmButton = hintPopup.querySelector('.hint-confirm-button');
    confirmButton.addEventListener('click', () => {
        document.body.removeChild(hintPopup); // 移除提示彈窗
    });
}





function disableCards() {
    score++; // 增加分數
    document.getElementById('score').textContent = score; // 更新分數顯示

    lockBoard = true; // 鎖定遊戲板，禁止點擊其他卡片

    setTimeout(() => {
        firstCard.style.visibility = 'hidden'; // 隱藏配對的第一張卡片
        secondCard.style.visibility = 'hidden'; // 隱藏配對的第二張卡片
        checkGameOver(); // 檢查是否所有牌都已消除
        resetBoard();
        lockBoard = false; // 在配對後重新解鎖遊戲板
    }, 1000);
}






function unflipCards() {
    lockBoard = true; // 鎖定遊戲板
    if (audio) {
        audio.pause(); // 停止音樂
        audio.currentTime = 0; // 重置音樂到起始位置
    }

    setTimeout(() => {
        firstCard.classList.remove('flipped');
        secondCard.classList.remove('flipped');
        resetBoard();
        lockBoard = false; // 在翻轉後重新解鎖遊戲板
    }, 1500);
}

function resetBoard() {
    [hasFlippedCard, lockBoard] = [false, false];
    [firstCard, secondCard] = [null, null];
}

function updateScore() {    
    document.getElementById('score').textContent = score;
}

// 隨機打亂卡片
function shuffle() {
    const cards = document.querySelectorAll('.memory-card');
    cards.forEach(card => {
        let randomPos = Math.floor(Math.random() * 12);
        card.style.order = randomPos;
    });
}

// 為卡片添加點擊事件監聽器
function addCardListeners() {
    const cards = document.querySelectorAll('.memory-card');
    cards.forEach(card => card.addEventListener('click', flipCard));
}

// 檢查遊戲是否結束
function checkGameOver() {
    const remainingCards = document.querySelectorAll('.memory-card:not([style*="visibility: hidden"])');
    if (remainingCards.length === 0) {
        document.getElementById('restart-button').style.display = 'block'; // 顯示重新開始按鈕
    }
}





// 當用戶點擊確認按鈕時隱藏訊息
document.getElementById('close-button').addEventListener('click', () => {
    document.getElementById('message-container').style.display = 'none';
});


// 重新開始遊戲邏輯
document.getElementById('restart-button').addEventListener('click', () => {    
    initGame(); // 重新初始化遊戲
    document.getElementById('restart-button').style.display = 'none'; // 隱藏重新開始按鈕
});

initGame(); // 初次加載遊戲


</script>




</body>
</html>
