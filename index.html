<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é–å½¤ç”Ÿæ—¥å€’æ•¸è¨ˆæ™‚å™¨</title>
  <link rel="stylesheet" href="styles.css">  
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>
<body>
<div id="arcade-frame">
<label for="test-date">é¸æ“‡æ¸¬è©¦æ—¥æœŸ:</label>
  <input type="date" id="test-date" onchange="setTestDate()">
<section id="countdown">
  <h1>Teacher Avery ç”Ÿæ—¥å€’æ•¸è¨ˆæ™‚å™¨</h1>
  <div id="digital-clock">
    <div class="digit">
      <span class="digit-label">å¤©</span>
      <span id="days" class="digit-value">00</span>
    </div>
    <div class="digit">
      <span class="digit-label">æ™‚</span>
      <span id="hours" class="digit-value">00</span>
    </div>
    <div class="digit">
      <span class="digit-label">åˆ†</span>
      <span id="minutes" class="digit-value">00</span>
    </div>
    <div class="digit">
      <span class="digit-label">ç§’</span>
      <span id="seconds" class="digit-value">00</span>
    </div>
  </div>

  <div id="warning-button">
    <button id="count-button" class="warning-btn">æ²’ç”¨æŒ‰éˆ•æ¬¡æ•¸: <span id="click-count">0</span></button>    
  </div>
  
    <div class="calendar-container">
        <img src="IMG/Sagittarius.jpg" alt="Sagittarius" class="sagittarius-image left">
        <img src="December.png" alt="Calendar" class="calendar-image">
        <img src="IMG/Sagittarius.jpg" alt="Sagittarius" class="sagittarius-image right">
        <div class="date-circle"></div> <!-- ç´…è‰²åœ“åœˆ -->
    </div>
  
	<img src="causon_bread.png" alt="causon_bread" class="causon_bread" onclick="playSound()">
	<audio id="clickSound">
		<source src="causon.mp3" type="audio/mpeg">
	</audio>

	<img src="causon.png" alt="causon" class="causon" id="causonImage" style="display: none;">

  
  
<section class="level-selector">
  <div class="level-card" onclick="showGame(1)">
    <h2>é—œå¡ 1</h2>    
    <p id="level1-countdown">å¸¸é§é–‹å•Ÿ!</p>
  </div>

  <div class="level-card" id="level-2" onclick="checkLevel2Access()">
    <h2>é—œå¡ 2</h2>    
    <p id="level2-countdown">é‚„å‰© <span id="level2-days">3</span> å¤© é–‹å•Ÿ</p> <!-- å€’æ•¸è¨ˆæ™‚é¡¯ç¤º -->
    <p id="limited-access-message" style="display: none;">é—œå¡é™æ™‚é–‹æ”¾ä¸­!</p> <!-- é™æ™‚é–‹æ”¾æ¶ˆæ¯ -->
  </div>

  <div class="level-card" id="level-3" onclick="checkLevel3Access()">
    <h2>é—œå¡ 3</h2>    
    <p id="level3-countdown">é‚„å‰© <span id="level3-days">5</span> å¤© é–‹å•Ÿ</p> <!-- å€’æ•¸è¨ˆæ™‚é¡¯ç¤º -->
    <p id="limited-access-message-3" style="display: none;">é—œå¡é™æ™‚é–‹æ”¾ä¸­!</p> <!-- é™æ™‚é–‹æ”¾æ¶ˆæ¯ -->
  </div>
</section>


<div id="hint-message" style="display: none;">ä»Šå¤©çš„æç¤ºå­—æ˜¯: <span id="hint-word">Re</span>ã€‚</div>
<div id="hint-message-3" style="display: none;" class="hint-message">
    ä»Šå¤©çš„æç¤ºå­—æ˜¯: <span id="hint-word-3">la</span>ã€‚
</div>
<!-- ä¸‰å€‹ä¸åŒçš„éŠæˆ²å€åŸŸ -->
<section id="game1" class="game-area" style="display: none;">
  <section id="game-section">
    <h2 class="game-title-modern"><span>é—œå¡ 1 -éŸ³æ¨‚</span> æ¶ˆæ¶ˆæ¨‚</h2>

    <div class="score-container">
      <p class="score-display">åˆ†æ•¸: <span id="score">0</span></p> <!-- é¡¯ç¤ºåˆ†æ•¸ -->
    </div>

    <div id="memory-game" class="memory-game">
      <!-- é€™è£¡çš„å¡ç‰‡å°‡é€šé JavaScript å‹•æ…‹ç”Ÿæˆ -->
    </div>

    <label for="volumeControl">éŸ³é‡:</label>
    <input type="range" id="volumeControl" min="0" max="1" step="0.01" value="0.1">
    <button id="restart-button" class="restart-btn" style="display: none;">é‡æ–°æ´—ç‰Œ</button>
  </section>

  <div id="message-container" style="display: none;">
    <p id="message-text"></p>
    <button id="close-button">ç¢ºèª</button>
  </div>
</section>

<section id="game2" class="game-area" style="display: none;">
  <h3 class="game-title">é—œå¡ 2 - å•ç­”éŠæˆ²</h3>
  <div id="quiz-container" class="quiz-container">
    <p id="question-number">ç¬¬ <span id="current-question-number">1</span> é¡Œ / ç¸½å…± 10 é¡Œ</p>
    <p id="question">è«‹å›ç­”å•é¡Œ</p>
	<div class="answer-row">
		<button class="answer-button" onclick="checkAnswer('A')">A. ç­”æ¡ˆ A</button>
		<button class="answer-button" onclick="checkAnswer('B')">B. ç­”æ¡ˆ B</button>
	</div>
	<div class="answer-row">
		<button class="answer-button" onclick="checkAnswer('C')">C. ç­”æ¡ˆ C</button>
		<button class="answer-button" onclick="checkAnswer('D')">D. ç­”æ¡ˆ D</button>
	</div>
    <p id="feedback"></p>
    <p id="score">ç­”å°é¡Œæ•¸: <span id="correct-count">0</span> / 10</p>
  </div>

  <!-- é‡æ–°é–‹å§‹æŒ‰éˆ• -->
  <button id="restartButton" class="restart-btn" onclick="restartQuiz()">é‡æ–°é–‹å§‹</button>

  <audio id="correctSound">
    <source src="voice/Correct.mp4" type="audio/mp4">
  </audio>
  <audio id="wrongSound">
    <source src="voice/wrong.mp4" type="audio/mp4">
  </audio>
</section>

<section id="game3" class="game-area" style="display: none;">
  <h3>é€™æ˜¯é—œå¡ 3 - æ‹¼åœ–éŠæˆ²(æ‹¼åœ–å¯ä»¥æ”¾åœ¨å¤–é¢å–”)</h3>
  
  <!-- åœ–ç‰‡é¸æ“‡å™¨ -->
  <div id="image-selector">
      <h4>é¸æ“‡è¦æ‹¼çš„åœ–ç‰‡:</h4>
      <img src="IMG/Puzzle_1/InuYasha.jpg" alt="InuYasha" data-image="InuYasha" class="selectable-image" />
      <img src="IMG/Puzzle_2/AceofDiamond.jpg" alt="Ace of Diamond" data-image="AceofDiamond" class="selectable-image" />
      <img src="IMG/Puzzle_3/Konan.jpg" alt="Konan" data-image="Konan" class="selectable-image" /> <!-- æ–°å¢çš„åœ–ç‰‡ -->
  </div>

  <div class="puzzle-container" id="puzzleContainer">
    <!-- æ‹¼åœ–å°å¡Šå°‡é€šé JavaScript å‹•æ…‹ç”Ÿæˆ -->
  </div>
  
  <div class="original-puzzle">
    <img src="IMG/Puzzle_1/InuYasha.jpg" alt="å®Œæ•´çš„æ‹¼åœ–" />
  </div>

  <p id="puzzle-status" style="display: none;">æ­å–œä½ å®Œæˆæ‹¼åœ–ï¼</p>
  <button onclick="shufflePuzzle()">é‡æ–°æ´—ç‰Œ</button>
</section>



<div style="text-align: center;">
  <a href="HB_for_avery.html">
    <img id="birthday-image" src="IMG/door.jpg" alt="Birthday Image" style="display: none; width: 300px; height: auto;">
  </a>
</div>
</div>
    <footer>
        <p>Â© æ­å°¼æ­ç‰ˆæ¬Šå¤§æ¦‚å§</p>
    </footer>

<script>
// ç•¶é»æ“Š causon_bread æ™‚åŸ·è¡Œçš„å‡½æ•¸
function playSound() {
    var audio = document.getElementById("clickSound");
    audio.volume = 0.3;
    audio.play();

    // é¡¯ç¤º causon.png åœ–ç‰‡ä¸¦å•Ÿå‹•å‹•ç•«
    var causonImage = document.getElementById("causonImage");
    causonImage.style.display = 'block';  // é¡¯ç¤ºåœ–ç‰‡
    causonImage.classList.add('animate');  // æ·»åŠ å‹•ç•«æ•ˆæœ

    // åœ¨å‹•ç•«çµæŸå¾Œå°‡åœ–ç‰‡éš±è—
    setTimeout(function() {
        causonImage.style.display = 'none';  // é‡æ–°éš±è—åœ–ç‰‡
        causonImage.classList.remove('animate');  // ç§»é™¤å‹•ç•«æ•ˆæœä»¥ä¾¿ä¸‹ä¸€æ¬¡é‡æ–°åŸ·è¡Œ
    }, 3000); // 3ç§’å¾Œéš±è—åœ–ç‰‡
}

function checkLevel2Access() {
  var days = parseInt(document.getElementById('days').textContent);
  if (days < 2) {
    showGame(2); // é¡¯ç¤ºç¬¬äºŒé—œ
  } else {
    alert("ç¬¬äºŒé—œå°šæœªé–‹å•Ÿï¼Œè«‹è€å¿ƒç­‰å€™ï¼");
  }
}

function checkLevel3Access() {
  var days = parseInt(document.getElementById('days').textContent);
  if (days < 1) { // æª¢æŸ¥å‰©é¤˜å¤©æ•¸æ˜¯å¦å°æ–¼1
    showGame(3); // é¡¯ç¤ºç¬¬ä¸‰é—œ
  } else {
    alert("ç¬¬ä¸‰é—œå°šæœªé–‹å•Ÿï¼Œè«‹è€å¿ƒç­‰å€™ï¼");
  }
}

// å€’æ•¸æ—¥æœŸ
var countdownDate = new Date('2024-12-08').getTime();
var clickCount = 0; // é»æ“Šè¨ˆæ•¸å™¨
var secondPhaseOpened = false; // è¨˜éŒ„ç¬¬äºŒé—œæ˜¯å¦å·²é–‹å•Ÿ
var thirdPhaseOpened = false; // é—œå¡ 3 çš„ç‹€æ…‹

function setTestDate() {
  var selectedDate = document.getElementById('test-date').value;
  if (selectedDate) {
    countdownDate = new Date(selectedDate).getTime(); // æ›´æ–°å€’æ•¸æ—¥æœŸç‚ºé¸æ“‡çš„æ¸¬è©¦æ—¥æœŸ
    updateCountdown(); // æ›´æ–°å€’æ•¸è¨ˆæ™‚
  }
}
// æ ¼å¼åŒ–é¡¯ç¤ºæ—¥æœŸæ•¸å­—
function padZero(num) {
  return num < 10 ? '0' + num : num;
}

// æ›´æ–°å€’æ•¸è¨ˆæ™‚å™¨
function updateCountdown() {
  var now = new Date().getTime();
  var distance = countdownDate - now;

  var days = Math.floor(distance / (1000 * 60 * 60 * 24));
  var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
  var seconds = Math.floor((distance % (1000 * 60)) / 1000);

  // æ›´æ–°æ•¸å­—é¡¯ç¤º
  document.getElementById('days').textContent = padZero(days);
  document.getElementById('hours').textContent = padZero(hours);
  document.getElementById('minutes').textContent = padZero(minutes);
  document.getElementById('seconds').textContent = padZero(seconds);

  // å€’æ•¸çµæŸæ™‚é¡¯ç¤ºç”Ÿæ—¥åœ–ç‰‡
  if (distance <= 0) {
    clearInterval(countdownInterval);
    document.getElementById('birthday-image').style.display = 'block';
  } else if (days < 2) {
    showCatAnimation();
  }

  // æ›´æ–°é—œå¡2ä¸­çš„å€’æ•¸é¡¯ç¤ºï¼Œä¸¦å°‡ days æ¸›å» 2
  var remainingDaysLevel2 = days - 2;
  document.getElementById('level2-countdown').textContent = `é‚„å‰© ${remainingDaysLevel2} å¤© é–‹å•Ÿ`;

  // ç•¶å‰©é¤˜æ™‚é–“å°æ–¼äºŒå¤©æ™‚é–‹å•Ÿç¬¬äºŒé—œ
  console.log("Days until birthday: " + days);
  if (days < 2 && !secondPhaseOpened) {
    secondPhaseOpened = true; // è¨­ç½®ç‚ºå·²é–‹å•Ÿ
    document.getElementById('level-2').style.display = 'block'; // é¡¯ç¤ºç¬¬äºŒé—œå…§å®¹
    document.getElementById('level2-countdown').style.display = 'none'; // éš±è—å€’æ•¸é¡¯ç¤º
    document.getElementById('limited-access-message').style.display = 'block'; // é¡¯ç¤ºé™æ™‚é–‹æ”¾çš„æ¶ˆæ¯
    console.log("Second phase opened!");
  }

  // æ›´æ–°é—œå¡3ä¸­çš„å€’æ•¸é¡¯ç¤ºï¼Œä¸¦å°‡ days æ¸›å» 1
  var remainingDaysLevel3 = days - 1;
  document.getElementById('level3-countdown').textContent = `é‚„å‰© ${remainingDaysLevel3} å¤© é–‹å•Ÿ`;

	// ç•¶å‰©é¤˜æ™‚é–“å°æ–¼ä¸€å¤©æ™‚é–‹å•Ÿç¬¬ä¸‰é—œ
	if (remainingDaysLevel3 < 1 && !thirdPhaseOpened) {
	  thirdPhaseOpened = true; // è¨­ç½®ç‚ºå·²é–‹å•Ÿ
	  document.getElementById('level-3').style.display = 'block'; // é¡¯ç¤ºç¬¬ä¸‰é—œå…§å®¹
	  document.getElementById('level3-countdown').style.display = 'none'; // éš±è—å€’æ•¸é¡¯ç¤º
	  document.getElementById('limited-access-message-3').style.display = 'block'; // é¡¯ç¤ºé™æ™‚é–‹æ”¾çš„æ¶ˆæ¯
	  console.log("Third phase opened!");
	}
}



// è¼”åŠ©å‡½æ•¸ï¼šè£œé›¶
function padZero(num) {
  return num < 10 ? '0' + num : num;
}

// é–‹å§‹å€’æ•¸è¨ˆæ™‚
var countdownInterval = setInterval(updateCountdown, 1000);

// æ›´æ–°é»æ“Šè¨ˆæ•¸ä¸¦é¡¯ç¤ºå°è©±æ¡†
document.getElementById("count-button").addEventListener("click", function() {
  clickCount++;
  document.getElementById("click-count").textContent = clickCount;

  if (clickCount >= 100) {
    alert("æ­å–œä½ é›¢ç”Ÿæ—¥åˆæ›´è¿‘ä¸€é»äº†!");
    clickCount = 0; // é‡æ–°æ­¸é›¶
    document.getElementById("click-count").textContent = clickCount; // æ›´æ–°é¡¯ç¤º
  }
});

function showCatAnimation() {
  var catImage = document.createElement('img');
  catImage.src = 'https://img.cgmodel.com/image/2020/0627/big/38830-614463665.gif';
  catImage.style.width = '150px';
  catImage.style.position = 'fixed';
  catImage.style.bottom = '20px';
  catImage.style.left = '-100px';
  catImage.style.animation = 'run-animation 5s linear forwards';
  document.body.appendChild(catImage);
  catImage.addEventListener('animationend', function() {
    catImage.remove();
  });
}

// é¡¯ç¤ºç‰¹å®šéŠæˆ²
function showGame(gameNumber) {
  // éš±è—æ‰€æœ‰éŠæˆ²å€åŸŸ
  document.getElementById('game1').style.display = 'none';
  document.getElementById('game2').style.display = 'none';
  document.getElementById('game3').style.display = 'none';
  
  // é¡¯ç¤ºå°æ‡‰çš„éŠæˆ²å€åŸŸ
  document.getElementById('game' + gameNumber).style.display = 'block';
}

// å•Ÿå‹•å€’æ•¸è¨ˆæ™‚å™¨
var countdownInterval = setInterval(updateCountdown, 1000);









// æ¶ˆæ¶ˆæ¨‚æ­Œæ›²å’Œåœ–ç‰‡çš„å°æ‡‰é—œä¿‚
const songs = [
    { song: 'voice/yuuri_BETELGEUSE.MP3', framework: 'yuuri_BETELGEUSE' },
    { song: 'voice/Aimer_HoshikuzuVenus.MP3', framework: 'Aimer_HoshikuzuVenus' },
    { song: 'voice/Aimer_Kataomoi.MP3', framework: 'Aimer_Kataomoi' },
    { song: 'voice/Aimer_RokutouseinoYoru.MP3', framework: 'Aimer_RokutouseinoYoru' },
    { song: 'voice/Aimer_ShiroiroKagerou.MP3', framework: 'Aimer_ShiroiroKagerou' },
	{ song: 'voice/Spyair_Orange.MP3', framework: 'Spyair_Orange' },
	{ song: 'voice/yuuri_Leo.MP3', framework: 'yuuri_Leo' },
	{ song: 'voice/yoasobi_blue.MP3', framework: 'yoasobi_blue' },
	{ song: 'voice/yoasobi_monster.MP3', framework: 'yoasobi_monster' },
	{ song: 'voice/yorushika_Algernon.MP3', framework: 'yorushika_Algernon' },
	{ song: 'voice/yorushika_Tadakiminohare.MP3', framework: 'yorushika_Tadakiminohare' },
    { song: 'voice/yuuri_DriedFlowers.MP3', framework: 'yuuri_DrideFlowers' },
	{ song: 'voice/ChoQmay_Anata No Koibito Ni Naritai.MP3', framework: 'ChoQmay_Anata No Koibito Ni Naritai' },
	{ song: 'voice/Rokudenashi_One Voice.MP3', framework: 'Rokudenashi_One Voice' },
	{ song: 'voice/milet, Aimer, Lilas Ikuta_Omokage.MP3', framework: 'milet, Aimer, Lilas Ikuta_Omokage' },
];


const yorushikaSongs = [
    { song: 'voice/yorushika_Algernon.MP3', framework: 'yorushika_Algernon' },
    { song: 'voice/yorushika_Tadakiminohare.MP3', framework: 'yorushika_Tadakiminohare' },
    { song: 'voice/yorushika_yusansan.MP3', framework: 'yorushika_yusansan' },
    { song: 'voice/yorushika_thoughtcrime.MP3', framework: 'yorushika_thoughtcrime' },
    { song: 'voice/yorushika_sayit.MP3', framework: 'yorushika_sayit' },
    { song: 'voice/yorushika_Plagiarism.MP3', framework: 'yorushika_Plagiarism' },
	{ song: 'voice/yorushika_harudorobou.MP3', framework: 'yorushika_harudorobou' },
	{ song: 'voice/yorushika_hananibourei.MP3', framework: 'yorushika_hananibourei' },	
	{ song: 'voice/yorushika_dakarabokuwaongakuwoyameta.MP3', framework: 'yorushika_dakarabokuwaongakuwoyameta' },	
	{ song: 'voice/yorushika_aporia.MP3', framework: 'yorushika_aporia' },
	{ song: 'voice/yorushika_leftrightconfusion.MP3', framework: 'yorushika_leftrightconfusion' },		
];



function addYorushikaImage() {
    const memoryGame = document.getElementById('memory-game');

    // æª¢æŸ¥æ˜¯å¦å·²ç¶“æœ‰ Yorushika å¡ç‰‡ï¼Œå¦‚æœæœ‰å‰‡ä¸å†æ’å…¥
    if (!document.querySelector('.yorushika-card')) {
        const yorushikaCard = `
            <div class="yorushika-card-container">
                <div class="yorushika-card">
                    <img src="IMG/yorushika.jpg" alt="Yorushika Special Level" />
                </div>
            </div>
        `;

        memoryGame.insertAdjacentHTML('beforeend', yorushikaCard);

        // ç‚ºYorushikaå¡ç‰‡æ·»åŠ é»æ“Šäº‹ä»¶ï¼Œé»æ“Šå¾Œåˆ‡æ›åˆ°Yorushikaå°ˆå±¬é—œå¡
        document.querySelector('.yorushika-card').addEventListener('click', () => {
            initYorushikaLevel(); // åˆ‡æ›åˆ°Yorushikaå°ˆå±¬é—œå¡
            showYorushikaMessage(); // é¡¯ç¤ºæç¤ºè¨Šæ¯
            showResetButton(); // é¡¯ç¤ºé‚„åŸæŒ‰éˆ•
        });
    }
}



// é¡¯ç¤ºæç¤ºè¨Šæ¯çš„å‡½æ•¸
function showYorushikaMessage() {
    const messageContainer = document.createElement('div');
    messageContainer.classList.add('yorushika-message');  // å¢åŠ æ¨£å¼é¡

    // ä½¿ç”¨ <p> åˆ†é–‹æç¤ºæ–‡å­—
    messageContainer.innerHTML = `
        <p>å·²åˆ‡æ›åˆ°yorushikaç‰¹æ®Šé›£åº¦</p>
        <p>ä¸­é–“çš„éŸ³æ¨‚éƒ½æœƒæ˜¯yorushikaçš„æ­Œæ›²</p>
    `;

    // è¨­ç½®æ–‡å­—é¡è‰²ç‚ºYorushikaé¢¨æ ¼çš„è—ç´«è‰²
    messageContainer.style.color = '#b0a0e2'; // æ·ºç´«è‰²

    // å°‡æç¤ºè¨Šæ¯æ·»åŠ åˆ°é é¢
    document.body.appendChild(messageContainer);

    // è¨­ç½®æç¤ºè¨Šæ¯é¡¯ç¤ºä¸€æ®µæ™‚é–“å¾Œæ¶ˆå¤±
    setTimeout(() => {
        messageContainer.remove();
    }, 4000); // 4ç§’å¾Œæç¤ºæ¶ˆæ¯æ¶ˆå¤±
}





// éš¨æ©Ÿé¸æ“‡ Yorushika æ­Œæ›²
function selectYorushikaSongs() {
    const shuffledYorushikaSongs = yorushikaSongs.sort(() => 0.5 - Math.random());
    selectedSongs = shuffledYorushikaSongs.slice(0, 4); // å–å‰4é¦–
}


// åˆå§‹åŒ–Yorushikaå°ˆå±¬é—œå¡
function initYorushikaLevel() {
    selectYorushikaSongs(); // é¸æ“‡Yorushikaçš„å››é¦–æ­Œæ›²
    generateCards(); // æ ¹æ“šé¸æ“‡çš„æ­Œæ›²ç”Ÿæˆå¡ç‰‡
    addCardListeners(); // æ·»åŠ å¡ç‰‡é»æ“Šäº‹ä»¶
    shuffle(); // éš¨æ©Ÿæ‰“äº‚å¡ç‰‡
}




let selectedSongs = [];

// éš¨æ©Ÿé¸æ“‡å››çµ„æ­Œæ›²
function selectSongs() {
    const shuffledSongs = songs.sort(() => 0.5 - Math.random());
    selectedSongs = shuffledSongs.slice(0, 4); // å–å‰4çµ„
}

// ä¿®æ”¹generateCardså‡½æ•¸ï¼Œä½¿å…¶èƒ½æ ¹æ“šæ‰€é¸æ­Œæ›²ç”Ÿæˆå°æ‡‰çš„å¡ç‰‡
function generateCards() {
    const memoryGame = document.getElementById('memory-game');
    memoryGame.innerHTML = ''; // æ¸…ç©ºéŠæˆ²å€åŸŸ

    const cardsHtml = selectedSongs.flatMap(song => [
        `<div class="memory-card" data-framework="${song.framework}">
            <img class="front-face" src="IMG/music_img.jpg" alt="${song.framework}" />
            <div class="back-face"></div>
        </div>`,
        `<div class="memory-card" data-framework="${song.framework}">
            <img class="front-face" src="IMG/${song.framework}.jpg" alt="${song.framework}" />
            <div class="back-face"></div>
        </div>`
    ]).join('');
    
    memoryGame.innerHTML = cardsHtml;
}

// åˆå§‹åŒ–æ™®é€šé—œå¡ï¼Œä¸¦åŠ ä¸ŠYorushikaåœ–ç‰‡
function initGame() {
    selectSongs(); // é¸æ“‡æ–°çš„å››é¦–æ­Œæ›²
    generateCards(); // æ ¹æ“šé¸æ“‡çš„æ­Œæ›²ç”Ÿæˆå¡ç‰‡
    addCardListeners(); // æ·»åŠ å¡ç‰‡é»æ“Šäº‹ä»¶
    shuffle(); // éš¨æ©Ÿæ‰“äº‚å¡ç‰‡
    addYorushikaImage(); // æ·»åŠ Yorushikaå°ˆå±¬åœ–ç‰‡
}

// æ¶ˆæ¶ˆæ¨‚é‚è¼¯
let hasFlippedCard = false;
let lockBoard = false;
let firstCard, secondCard;
let score = 00; // åˆ†æ•¸åˆå§‹åŒ–
let audio; // è²éŸ³è®Šæ•¸

const volumeControl = document.getElementById('volumeControl'); // ç²å–éŸ³é‡æ§åˆ¶å…ƒç´ 

function flipCard() {
    if (lockBoard) return; // å¦‚æœéŠæˆ²æ¿è¢«é–å®šï¼Œå‰‡ä¸å…è¨±é»æ“Š
    if (this === firstCard) return;

    this.classList.add('flipped');

    // æª¢æŸ¥æ˜¯å¦é»æ“Šçš„æ˜¯æœ‰éŸ³æ¨‚çš„å¡ç‰‡
    const imgElement = this.querySelector('.front-face');
    if (imgElement && imgElement.getAttribute('src').includes('music_img.jpg')) {
        if (audio) {
            audio.pause(); // å¦‚æœæœ‰æ­£åœ¨æ’­æ”¾çš„éŸ³æ¨‚ï¼Œå‰‡åœæ­¢
            audio.currentTime = 0; // é‡ç½®æ™‚é–“
        }

        // æ ¹æ“šæ¡†æ¶åç¨±é¸æ“‡å°æ‡‰çš„éŸ³æ¨‚
        const selectedSong = selectedSongs.find(song => song.framework === this.dataset.framework);
        if (selectedSong) {
            audio = new Audio(selectedSong.song); // æ’­æ”¾å°æ‡‰éŸ³æ¨‚
			audio.volume = volumeControl.value; // ä½¿ç”¨éŸ³é‡æ§åˆ¶æ¢ç•¶å‰å€¼
            audio.play().catch(err => {
                console.error('éŸ³æ¨‚æ’­æ”¾éŒ¯èª¤:', err);  // æ•ç²æ’­æ”¾éŒ¯èª¤
            });
        }
    }

    if (!hasFlippedCard) {
        hasFlippedCard = true;
        firstCard = this;
        return;
    }

    secondCard = this;

    // çŸ­æš«å»¶é²å¾Œæª¢æŸ¥æ˜¯å¦åŒ¹é…
    setTimeout(checkForMatch, 300); // å¢åŠ å»¶é²ï¼Œè®“ç¿»é–‹çš„å¡ç‰‡æ›´æ˜é¡¯
}

// ç›£è½éŸ³é‡æ§åˆ¶æ»‘å‹•æ¢ï¼Œå‹•æ…‹èª¿æ•´éŸ³é‡
volumeControl.addEventListener('input', function() {
    if (audio) {
        audio.volume = this.value;  // å‹•æ…‹èª¿æ•´éŸ³é‡
    }
});


function checkForMatch() {
    let isMatch = firstCard.dataset.framework === secondCard.dataset.framework;

    if (isMatch) {
        disableCards(); // é–å®šå¡ç‰‡
        // å–å¾—æ­Œæ›²åç¨±å’Œæ­Œæ‰‹åç¨±
        const selectedSong = selectedSongs.find(song => song.framework === firstCard.dataset.framework);
        
        // æå–æ­Œåå’Œæ­Œæ‰‹å
        const songName = selectedSong.framework.split('_')[1]; // æå–ä¸‹åŠƒç·šå¾Œçš„éƒ¨åˆ†
        const singerName = selectedSong.song.split('/')[1].split('_')[0]; // å¾æ–‡ä»¶åæå–æ­Œæ‰‹å
        
        // é¡¯ç¤ºåŒ¹é…æˆåŠŸçš„æ¶ˆæ¯
        showMatchMessage(songName, singerName);
        
    } else {
        unflipCards(); // å¦‚æœä¸åŒ¹é…ï¼Œå‰‡ç¿»å›å»
    }
}

function showMatchMessage(songName, artist) {
    // é–å®šéŠæˆ²æ¿
    lockBoard = true;

    // å‰µå»ºè¦†è“‹å±¤
    const overlay = document.createElement('div');
    overlay.id = 'overlay';
    overlay.style.position = 'fixed';
    overlay.style.top = '0';
    overlay.style.left = '0';
    overlay.style.width = '100%';
    overlay.style.height = '100%';
    overlay.style.backgroundColor = 'rgba(0, 0, 0, 0.5)'; // åŠé€æ˜èƒŒæ™¯
    overlay.style.zIndex = '999'; // ç¢ºä¿åœ¨æœ€ä¸Šé¢
    document.body.appendChild(overlay);

    const matchMessage = document.createElement('div');
    matchMessage.id = 'match-message';
    matchMessage.innerHTML = `
        <div class="match-message-content">
            <p>ğŸ‰ æ­å–œä½ ç­”å°äº†!! ğŸ‰</p>
            <p>æ­Œåç‚º: "${songName}"</p>
            <p>æ­Œæ‰‹ç‚º: "${artist}"</p>
            <button id="confirm-button">ç¢ºèª <span class="small-text">(è«‹ç­‰å¾Œæ–¹å¡ç‰‡æ¶ˆå¤±å†æŒ‰)</span></button>
        </div>
    `;
    document.body.appendChild(matchMessage);

    // é»æ“Šç¢ºèªæŒ‰éˆ•æ™‚ï¼Œé—œé–‰æç¤ºè¦–çª—å’Œè¦†è“‹å±¤
    document.getElementById('confirm-button').addEventListener('click', () => {
        document.body.removeChild(matchMessage); // ç§»é™¤æç¤ºè¦–çª—
        document.body.removeChild(overlay); // ç§»é™¤è¦†è“‹å±¤
        lockBoard = false; // ç¢ºèªå¾Œè§£é–éŠæˆ²æ¿
        resetBoard(); // é‡ç½®ç¿»ç‰Œç‹€æ…‹

        // æª¢æŸ¥åˆ†æ•¸æ˜¯å¦é”åˆ°10åˆ†ï¼Œé¡¯ç¤ºæç¤ºè¨Šæ¯
        if (score === 10) {
            showHintPopup(); // é¡¯ç¤ºæç¤ºå­—çš„å½ˆçª—
        }
    });
}

function showHintPopup() {
    // å‰µå»ºæç¤ºå½ˆçª—
    const hintPopup = document.createElement('div');
    hintPopup.id = 'hint-popup';
    hintPopup.innerHTML = `
        <div class="hint-popup-content">
            <p style="color: #ff4081;"> ä»Šå¤©çš„æç¤ºå­—æ˜¯: <strong style="color: #ff4081;">RE</strong> </p>
            <button class="hint-confirm-button">ç¢ºèª</button>
        </div>
    `;
    
    document.body.appendChild(hintPopup);

    // é»æ“Šç¢ºèªæŒ‰éˆ•æ™‚ï¼Œé—œé–‰æç¤ºå½ˆçª—
    const confirmButton = hintPopup.querySelector('.hint-confirm-button');
    confirmButton.addEventListener('click', () => {
        document.body.removeChild(hintPopup); // ç§»é™¤æç¤ºå½ˆçª—
    });
}





function disableCards() {
    score++; // å¢åŠ åˆ†æ•¸
    document.getElementById('score').textContent = score; // æ›´æ–°åˆ†æ•¸é¡¯ç¤º

    lockBoard = true; // é–å®šéŠæˆ²æ¿ï¼Œç¦æ­¢é»æ“Šå…¶ä»–å¡ç‰‡

    setTimeout(() => {
        firstCard.style.visibility = 'hidden'; // éš±è—é…å°çš„ç¬¬ä¸€å¼µå¡ç‰‡
        secondCard.style.visibility = 'hidden'; // éš±è—é…å°çš„ç¬¬äºŒå¼µå¡ç‰‡
        checkGameOver(); // æª¢æŸ¥æ˜¯å¦æ‰€æœ‰ç‰Œéƒ½å·²æ¶ˆé™¤
        resetBoard();
        lockBoard = false; // åœ¨é…å°å¾Œé‡æ–°è§£é–éŠæˆ²æ¿
    }, 1000);
}






function unflipCards() {
    lockBoard = true; // é–å®šéŠæˆ²æ¿
    if (audio) {
        audio.pause(); // åœæ­¢éŸ³æ¨‚
        audio.currentTime = 0; // é‡ç½®éŸ³æ¨‚åˆ°èµ·å§‹ä½ç½®
    }

    setTimeout(() => {
        firstCard.classList.remove('flipped');
        secondCard.classList.remove('flipped');
        resetBoard();
        lockBoard = false; // åœ¨ç¿»è½‰å¾Œé‡æ–°è§£é–éŠæˆ²æ¿
    }, 1500);
}

function resetBoard() {
    [hasFlippedCard, lockBoard] = [false, false];
    [firstCard, secondCard] = [null, null];
}

function updateScore() {    
    document.getElementById('score').textContent = score;
}

// éš¨æ©Ÿæ‰“äº‚å¡ç‰‡
function shuffle() {
    const cards = document.querySelectorAll('.memory-card');
    cards.forEach(card => {
        let randomPos = Math.floor(Math.random() * 12);
        card.style.order = randomPos;
    });
}

// ç‚ºå¡ç‰‡æ·»åŠ é»æ“Šäº‹ä»¶ç›£è½å™¨
function addCardListeners() {
    const cards = document.querySelectorAll('.memory-card');
    cards.forEach(card => card.addEventListener('click', flipCard));
}

// æª¢æŸ¥éŠæˆ²æ˜¯å¦çµæŸ
function checkGameOver() {
    const remainingCards = document.querySelectorAll('.memory-card:not([style*="visibility: hidden"])');
    if (remainingCards.length === 0) {
        document.getElementById('restart-button').style.display = 'block'; // é¡¯ç¤ºé‡æ–°é–‹å§‹æŒ‰éˆ•
    }
}





// ç•¶ç”¨æˆ¶é»æ“Šç¢ºèªæŒ‰éˆ•æ™‚éš±è—è¨Šæ¯
document.getElementById('close-button').addEventListener('click', () => {
    document.getElementById('message-container').style.display = 'none';
});


// é‡æ–°é–‹å§‹éŠæˆ²é‚è¼¯
document.getElementById('restart-button').addEventListener('click', () => {    
    initGame(); // é‡æ–°åˆå§‹åŒ–éŠæˆ²
    document.getElementById('restart-button').style.display = 'none'; // éš±è—é‡æ–°é–‹å§‹æŒ‰éˆ•
});

initGame(); // åˆæ¬¡åŠ è¼‰éŠæˆ²







const questions = [
  {
    question: "Aimer çš„å“ªä¸€é¦–æ­Œæ›²æ˜¯å‹•ç•«ã€ŠFate/stay nightã€‹UBW çš„ç‰‡å°¾æ›²ï¼Ÿ",
    options: { A: "Brave Shine", B: "Kataomoi", C: "Rokutousei no Yoru", D: "Ref:rain" },
    answer: "A"
  },
    {
    question: "æ€ªç›œåŸºå¾·çš„é¦–æ¬¡ç™»å ´æ˜¯åœ¨ã€Šååµæ¢æŸ¯å—ã€‹çš„ç¬¬å¹¾é›†ï¼Ÿ",
    options: { A: "ç¬¬50é›†", B: "ç¬¬76é›†", C: "ç¬¬125é›†", D: "ç¬¬219é›†" },
    answer: "B"
  },
    {
    question: "ç°åŸå“€çš„æœ¬åæ˜¯ä»€éº¼ï¼Ÿ",
    options: { A: "å®®é‡æ˜ç¾", B: "å®®é‡å¿—ä¿", C: "å·¥è—¤æœ‰å¸Œå­", D: "å¦ƒè‹±ç†" },
    answer: "B"
  },
   {
    question: "ã€Šååµæ¢æŸ¯å—ã€‹çš„ä½œè€…æ˜¯èª°ï¼Ÿ",
    options: { A: "é’å±±å‰›æ˜Œ", B: "é³¥å±±æ˜", C: "å²¸æœ¬é½Šå²", D: "å°¾ç”°æ¦®ä¸€éƒ" },
    answer: "A"
  },
   {
    question: "æ€ªç›œåŸºå¾·çš„çœŸå¯¦èº«ä»½æ˜¯èª°ï¼Ÿ",
    options: { A: "æœéƒ¨å¹³æ¬¡", B: "å·¥è—¤æ–°ä¸€", C: "é»‘ç¾½å¿«æ–—", D: "ç™½é¦¬æ¢" },
    answer: "C"
  },
    {
    question: "é™è°· æšï¼ˆãµã‚‹ã‚„ ã•ã¨ã‚‹ï¼‰çš„æŠ•çƒé¢¨æ ¼ä¸»è¦ä»¥ä»€éº¼ç‚ºç‰¹é»ï¼Ÿ",
    options: { A: "å¿«é€Ÿçƒ", B: "æ›²çƒ", C: "è®Šé€Ÿçƒ", D: "æŒ‡å‰çƒ" },
    answer: "A"
  },
    {
    question: "å°æ¹Š æ˜¥å¸‚ï¼ˆã“ã¿ãªã¨ ã¯ã‚‹ã„ã¡ï¼‰çš„ç‰¹é•·æ˜¯ä»€éº¼ï¼Ÿ",
    options: { A: "æ‰“æ“Š", B: "å®ˆå‚™", C: "è·‘å£˜", D: "æˆ°è¡“" },
    answer: "A"
  },
   {
    question: "å“ªä½è§’è‰²æ“”ä»»é’é“é«˜æ ¡çš„æ•æ‰‹ï¼Ÿ",
    options: { A: "å€‰æŒ æ´‹ä¸€ï¼ˆãã‚‰ã‚‚ã¡ ã‚ˆã†ã„ã¡ï¼‰", B: "å°æ¹Š æ˜¥å¸‚ï¼ˆã“ã¿ãªã¨ ã¯ã‚‹ã„ã¡ï¼‰", C: "é™è°· æšï¼ˆãµã‚‹ã‚„ ã•ã¨ã‚‹)", D: "å¾¡å¹¸ ä¸€ä¹Ÿï¼ˆã¿ã‚†ã ã‹ãšã‚„ï¼‰" },
    answer: "D"
  },
    {
    question: "æ€ªç›œåŸºå¾·é€šå¸¸æœƒäº‹å…ˆçµ¦è­¦æ–¹é€ä»€éº¼ä¾†é å‘Šä»–çš„è¡Œå‹•ï¼Ÿ",
    options: { A: "ç•«åƒ", B: "é›»å­éƒµä»¶", C: "æŒ‘æˆ°ä¿¡", D: "å¯¶çŸ³æ¨£å“" },
    answer: "C"
  },
   {
    question: "å·¥è—¤æ–°ä¸€ç•¶åˆè¢«çŒä¸‹çš„è—¥åŠ‘åç¨±æ˜¯ä»€éº¼ï¼Ÿ",
    options: { A: "APTX 4869", B: "VX 3000", C: "XK-500", D: "MDX-900" },
    answer: "A"
  },
   {
    question: "æ€ªç›œåŸºå¾·çš„ç›®æ¨™é€šå¸¸æ˜¯ä»€éº¼é¡å‹çš„ç‰©å“ï¼Ÿ",
    options: { A: "å¤è‘£", B: "ç å¯¶å’Œå¯¶çŸ³", C: "æ–‡æ›¸æ–‡ä»¶", D: "è—è¡“å“" },
    answer: "B"
  },
  {
    question: "Yuuri çš„å“ªä¸€é¦–æ­Œæ›²è®“ä»–è¿…é€Ÿæˆåï¼Œä¸¦ç™»ä¸Šæ’è¡Œæ¦œï¼Ÿ",
    options: { A: "BETELGEUSE", B: "Dried Flowers", C: "Infinity", D: "Leo" },
    answer: "B"
  },
  {
    question: "Yoasobi çš„å“ªä¸€é¦–æ­Œè¢«ç”¨ä½œã€ŠBEASTARSã€‹ç¬¬äºŒå­£çš„ç‰‡é ­æ›²ï¼Ÿ",
    options: { A: "Yoru ni Kakeru", B: "Ano Yume o Nazotte", C: "Kaibutsu", D: "Halzion" },
    answer: "C"
  },
  {
    question: "Yorushika çš„ä¸»å”± n-buna èˆ‡èª°å…±åŒçµ„æˆäº†æ¨‚éšŠï¼Ÿ",
    options: { A: "Hoshino Gen", B: "Ikuta Lilas", C: "suis", D: "Aimer" },
    answer: "C"
  },
  {
    question: "Aimer çš„ç¬¬ä¸€å¼µå°ˆè¼¯åç¨±æ˜¯ä»€éº¼ï¼Ÿ",
    options: { A: "Midnight Sun", B: "Sleepless Nights", C: "Daydream", D: "After Dark" },
    answer: "B"
  },
  {
    question: "Yoasobi çš„é¦–å¼µæ•¸ä½å–®æ›²ã€ŠYoru ni Kakeruã€‹æ˜¯æ”¹ç·¨è‡ªå“ªéƒ¨å°èªªï¼Ÿ",
    options: { A: "å¤¢ã®é›«ã¨æ˜Ÿã®èŠ±", B: "ãƒ¤ãƒ¡ã‚´ã‚¯", C: "ã‚¿ãƒŠãƒˆã‚¹ã®èª˜æƒ‘", D: "ã‚¿ã‚¤ãƒ ãƒã‚·ãƒ³" },
    answer: "A"
  },
  {
    question: "Yorushika çš„å“ªä¸€é¦–æ­Œæ›²ä»¥ã€Œå¿˜è¨˜æ„›äººã€çš„ä¸»é¡Œç‚ºèƒŒæ™¯ï¼Ÿ",
    options: { A: "æ˜¥æ³¥æ£’", B: "å¤œè¡Œ", C: "èŠ±ã«äº¡éœŠ", D: "ã ã‹ã‚‰åƒ•ã¯éŸ³æ¥½ã‚’è¾ã‚ãŸ" },
    answer: "A"
  },
  {
    question: "Yoasobi çš„æ­Œæ›²ã€Œå¤œã«é§†ã‘ã‚‹ã€æè¿°çš„æ˜¯ä»€éº¼ä¸»é¡Œï¼Ÿ",
    options: { A: "å­¤ç¨", B: "æ„›æƒ…", C: "æ‡·èˆŠ", D: "å¤¢æƒ³" },
    answer: "A"
  },
    {
    question: "åœ¨æŸ¯å—çš„æ•…äº‹ä¸­ï¼Œé»‘æš—çµ„ç¹”çš„ä»£è™Ÿã€ç´é…’ã€çš„æ­æª”æ˜¯èª°ï¼Ÿ",
    options: { A: "é›ªè‰", B: "ä¼ç‰¹åŠ ", C: "åŸºçˆ¾", D: "é›·åˆ©" },
    answer: "B"
  },
  {
    question: "Yorushika çš„å“ªé¦–æ­Œä»¥ã€Œæ—…é€”ã€ç‚ºä¸»é¡Œï¼Ÿ",
    options: { A: "Sora ni Utaeba", B: "Hikaru Nara", C: "Hana ni Arashi", D: "Hikaru" },
    answer: "C"
  },
  {
    question: "Yorushika çš„ä¸»å”±æ˜¯å“ªä½éŸ³æ¨‚äººï¼Ÿ",
    options: { A: "Aimer", B: "n-buna", C: "Yuuri", D: "Ayase" },
    answer: "B"
  },
  {
    question: "Aimer åœ¨å“ªä¸€å¹´é¦–æ¬¡å‡ºé“ï¼Ÿ",
    options: { A: "2011å¹´", B: "2012å¹´", C: "2013å¹´", D: "2014å¹´" },
    answer: "A"
  },
  {
    question: "Aimer çš„å“ªä¸€é¦–æ­Œæ›²æ˜¯ã€ŠKoi wa Ameagari no You niã€‹çš„ç‰‡å°¾æ›²ï¼Ÿ",
    options: { A: "StarRingChild", B: "I beg you", C: "Ref:rain", D: "Zero" },
    answer: "C"
  },
   {
    question: "Yoasobi çš„æ­Œæ›²ã€ŒHarukaã€æ˜¯æ ¹æ“šå“ªéƒ¨ä½œå“æ”¹ç·¨çš„ï¼Ÿ",
    options: { A: "å°èª¬ã€Šæ€ªè«‡ã€‹", B: "å°èª¬ã€Šæœˆç‹å­ã€‹", C: "å°èª¬ã€Šå¤§å…”å­ã€‹", D: "å°èª¬ã€Šä¸å¹¸çš„æµæµªè€…ã€‹" },
    answer: "B"
  },
  {
    question: "åœ¨ Yoasobi ä¸­ï¼Œå“ªä½æˆå“¡è² è²¬ä½œæ›²å’Œç·¨æ›²ï¼Ÿ",
    options: { A: "Aimer", B: "Ayase", C: "n-buna", D: "Yuuri" },
    answer: "B"
  },
];


// éš¨æ©Ÿé¸æ“‡ 10 é¡Œ
function selectRandomQuestions(allQuestions, num) {
  const shuffled = [...allQuestions].sort(() => 0.5 - Math.random());
  return shuffled.slice(0, num);
}



let currentQuestionIndex = 0; // ç•¶å‰å•é¡Œçš„ç´¢å¼•
let correctCount = 0; // ç­”å°é¡Œæ•¸
let answeringAllowed = true; // æ§åˆ¶æ˜¯å¦å¯ä»¥å›ç­”
let selectedQuestions = selectRandomQuestions(questions, 10); // éš¨æ©Ÿé¸æ“‡çš„ 10 é¡Œ

// é¡¯ç¤ºä¸‹ä¸€é¡Œ
function displayNextQuestion() {
  if (currentQuestionIndex < selectedQuestions.length) { // ç¢ºèªä»æœ‰å•é¡Œå¯é¡¯ç¤º
    const questionData = selectedQuestions[currentQuestionIndex]; // ç²å–ç•¶å‰å•é¡Œè³‡æ–™
    document.getElementById('current-question-number').textContent = currentQuestionIndex + 1; // æ›´æ–°é¡Œè™Ÿ
    document.getElementById('question').textContent = questionData.question; // æ›´æ–°å•é¡Œå…§å®¹

    // æ›´æ–°é¸é …æ–‡å­—
    document.getElementsByClassName('answer-button')[0].textContent = `A. ${questionData.options.A}`;
    document.getElementsByClassName('answer-button')[1].textContent = `B. ${questionData.options.B}`;
    document.getElementsByClassName('answer-button')[2].textContent = `C. ${questionData.options.C}`;
    document.getElementsByClassName('answer-button')[3].textContent = `D. ${questionData.options.D}`;
    
    document.getElementById('feedback').textContent = ""; // æ¸…ç©ºåé¥‹ä¿¡æ¯
  } else {
    // é¡¯ç¤ºçµæœ
    if (correctCount >= 6) {
      document.getElementById('quiz-container').innerHTML = `
        <div class="result-message success">
          <h2>æ­å–œï¼ä½ ç­”å°äº†è¶…éå…­é¡Œï¼</h2>
          <p>ä»Šå¤©çš„æç¤ºå­—æ˜¯: <strong>ga</strong></p> <!-- é¡¯ç¤ºæç¤ºå­— -->
        </div>
      `;
    } else {
      document.getElementById('quiz-container').innerHTML = `
        <div class="result-message failure">
          <h2>éŠæˆ²çµæŸï¼å¾ˆå¯æƒœï¼Œä½ æœªèƒ½ç­”å°å…­é¡Œã€‚</h2>
          <p>å†æ¥å†å²ï¼Œä¸‹æ¬¡æœƒæ›´å¥½ï¼</p>
        </div>
      `;
    }
  }
  answeringAllowed = true; // å…è¨±å›ç­”ä¸‹ä¸€é¡Œ
}

// æª¢æŸ¥ç­”æ¡ˆ
function checkAnswer(selectedOption) {
  if (!answeringAllowed) return; // å¦‚æœä¸å…è¨±å›ç­”ï¼Œå‰‡ç›´æ¥è¿”å›

  const questionData = selectedQuestions[currentQuestionIndex]; // ä½¿ç”¨ selectedQuestions
  const feedbackElement = document.getElementById('feedback');
  const correctSound = document.getElementById('correctSound');
  const wrongSound = document.getElementById('wrongSound');

  answeringAllowed = false; // ç¦æ­¢å†æ¬¡å›ç­”
  
  
  // è¨­å®šéŸ³æ•ˆéŸ³é‡
  correctSound.volume = 0.1; // è¨­å®šæ­£ç¢ºéŸ³æ•ˆéŸ³é‡
  wrongSound.volume = 0.1; // è¨­å®šéŒ¯èª¤éŸ³æ•ˆéŸ³é‡

  if (selectedOption === questionData.answer) {
    correctCount++;
    feedbackElement.textContent = "å›ç­”æ­£ç¢ºï¼";
    feedbackElement.style.color = "green";
    correctSound.play();
  } else {
    feedbackElement.textContent = `å›ç­”éŒ¯èª¤ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯: ${questionData.answer}.`;
    feedbackElement.style.color = "red";
    wrongSound.play();
  }

  // æ›´æ–°ç­”å°é¡Œæ•¸é¡¯ç¤º
  document.getElementById('correct-count').textContent = correctCount;

  // ç§»å‹•åˆ°ä¸‹ä¸€é¡Œ
  currentQuestionIndex++;
  setTimeout(displayNextQuestion, 3000); // ç­‰å¾… 3 ç§’å¾Œé¡¯ç¤ºä¸‹ä¸€é¡Œ
}

// éš¨æ©ŸåŒ–å•é¡Œ
function shuffleQuestions() {
  for (let i = questions.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [questions[i], questions[j]] = [questions[j], questions[i]];
  }
}

// åˆå§‹åŒ–éŠæˆ²
function startQuiz() {
  displayNextQuestion(); // é¡¯ç¤ºç¬¬ä¸€é¡Œ
}

function restartQuiz() {
  // éš¨æ©Ÿé¸æ“‡æ–°çš„ 10 é¡Œ
  selectedQuestions = selectRandomQuestions(questions, 10); // é‡æ–°éš¨æ©Ÿé¸æ“‡å•é¡Œ

  // é‡ç½®éŠæˆ²ç‹€æ…‹
  currentQuestionIndex = 0;
  correctCount = 0;

  // é‡ç½® UI ä¸¦æº–å‚™é–‹å§‹æ–°çš„éŠæˆ²
  document.getElementById('quiz-container').innerHTML = `
    <p id="question-number">ç¬¬ <span id="current-question-number">1</span> é¡Œ / ç¸½å…± 10 é¡Œ</p>
    <p id="question">è«‹å›ç­”å•é¡Œ</p>
    <div class="answer-row">
      <button class="answer-button" onclick="checkAnswer('A')">A. ç­”æ¡ˆ A</button>
      <button class="answer-button" onclick="checkAnswer('B')">B. ç­”æ¡ˆ B</button>
    </div>
    <div class="answer-row">
      <button class="answer-button" onclick="checkAnswer('C')">C. ç­”æ¡ˆ C</button>
      <button class="answer-button" onclick="checkAnswer('D')">D. ç­”æ¡ˆ D</button>
    </div>
    <p id="feedback"></p>
    <p id="score">ç­”å°é¡Œæ•¸: <span id="correct-count">0</span> / 10</p>
  `;

  // é–‹å§‹æ–°çš„éŠæˆ²ï¼Œé¡¯ç¤ºç¬¬ä¸€å€‹å•é¡Œ
  displayNextQuestion();
}


// å‘¼å«é–‹å§‹éŠæˆ²çš„å‡½æ•¸
startQuiz();




let piecesCount = 25; // åˆå§‹ç‚º 5x5 æ‹¼åœ–
let shuffledPositions = [];
let puzzleImage = 'InuYasha'; // åˆå§‹åœ–ç‰‡
let puzzleFolder = 'Puzzle_1'; // åˆå§‹è³‡æ–™å¤¾
let originalDimensions = { width: 800, height: 450 }; // å›ºå®šæ‹¼åœ–å®¹å™¨çš„å°ºå¯¸

// åŸå§‹åœ–ç‰‡å°ºå¯¸
const imageDimensions = {
    'InuYasha': { width: 1280, height: 814 }, // åœ–ç‰‡ 1
    'AceofDiamond': { width: 213, height: 136 }, // åœ–ç‰‡ 2
    'Konan': { width: 267, height: 189 } // åœ–ç‰‡ 3
};

// åˆå§‹åŒ–æ‹¼åœ–
function initializePuzzle() {
    const puzzleContainer = document.getElementById("puzzleContainer");
    puzzleContainer.innerHTML = ""; // æ¸…ç©ºå®¹å™¨

    // æ›´æ–°å®¹å™¨å°ºå¯¸
    updatePuzzleContainerSize();

    shuffledPositions = generateShuffledPositions();

    for (let i = 1; i <= piecesCount; i++) {
        const piece = document.createElement("div");
        piece.classList.add("puzzle-piece");

        // è¨ˆç®—æ‹¼åœ–å¡Šçš„å°ºå¯¸
        const pieceWidth = (originalDimensions.width / Math.sqrt(piecesCount));
        const pieceHeight = (originalDimensions.height / Math.sqrt(piecesCount));

        piece.style.width = `${pieceWidth}px`;
        piece.style.height = `${pieceHeight}px`;

        piece.style.backgroundImage = `url('IMG/${puzzleFolder}/${puzzleImage}_${i}.jpg')`; // æ›´æ–°è·¯å¾‘

        // ä½¿ç”¨äº‚æ•¸ä½ç½®
        const { x, y } = shuffledPositions[i - 1];
        piece.style.left = `${x}px`;
        piece.style.top = `${y}px`;

        piece.dataset.index = i;

        // æ·»åŠ æ»‘é¼ æ‹–å‹•åŠŸèƒ½
        addDragFunctionality(piece);

        puzzleContainer.appendChild(piece);
    }

    // æ›´æ–°å®Œæ•´æ‹¼åœ–çš„åœ–ç‰‡
    updateOriginalPuzzleImage();
}

// æ›´æ–°å®Œæ•´æ‹¼åœ–çš„åœ–ç‰‡
function updateOriginalPuzzleImage() {
    const originalPuzzleImage = document.querySelector('.original-puzzle img');
    originalPuzzleImage.src = `IMG/${puzzleFolder}/${puzzleImage}.jpg`; // æ›´æ–°å®Œæ•´æ‹¼åœ–è·¯å¾‘
}

// æ›´æ–°æ‹¼åœ–å®¹å™¨çš„å¤§å°
function updatePuzzleContainerSize() {
    const puzzleContainer = document.querySelector(".puzzle-container");
    const gridSize = Math.sqrt(piecesCount);

    puzzleContainer.style.width = `${originalDimensions.width}px`; // å›ºå®šå¯¬åº¦
    puzzleContainer.style.height = `${(originalDimensions.height / gridSize) * gridSize}px`; // é«˜åº¦æ ¹æ“šè¡Œæ•¸è¨ˆç®—
}

// ç”Ÿæˆäº‚æ•¸ä½ç½®
function generateShuffledPositions() {
    const positions = [];
    const gridSize = Math.sqrt(piecesCount); // ç²å–è¡Œæ•¸

    for (let y = 0; y < gridSize; y++) {
        for (let x = 0; x < gridSize; x++) {
            positions.push({ x: x * (originalDimensions.width / gridSize), y: y * (originalDimensions.height / gridSize) }); // ä½¿ç”¨æ‹¼åœ–å¡Šçš„å¤§å°
        }
    }
    return positions.sort(() => Math.random() - 0.5);
}

// æ›´æ”¹æ‹¼åœ–å°ºå¯¸
function changePuzzleSize(size) {
    if (size === '5x5') {
        piecesCount = 25; // 5x5 æ‹¼åœ–
        puzzleFolder = 'Puzzle_1'; // æ›´æ–°è³‡æ–™å¤¾
        puzzleImage = 'InuYasha'; // æ›´æ–°åœ–ç‰‡å
        originalDimensions = { width: 800, height: 450 }; // æ›´æ–°å°ºå¯¸
    } else if (size === '6x6') {
        if (puzzleImage === 'AceofDiamond') {
            piecesCount = 36; // 6x6 æ‹¼åœ–
            puzzleFolder = 'Puzzle_2'; // æ›´æ–°è³‡æ–™å¤¾
            const scaleFactor = originalDimensions.width / imageDimensions[puzzleImage].width; // è¨ˆç®—ç¸®æ”¾å› å­
            originalDimensions = { 
                width: imageDimensions[puzzleImage].width * scaleFactor, 
                height: imageDimensions[puzzleImage].height * scaleFactor 
            }; // æ›´æ–°å°ºå¯¸
        } else if (puzzleImage === 'Konan') {
            piecesCount = 36; // 6x6 æ‹¼åœ–
            puzzleFolder = 'Puzzle_3'; // æ›´æ–°è³‡æ–™å¤¾
            const scaleFactor = originalDimensions.width / imageDimensions[puzzleImage].width; // è¨ˆç®—ç¸®æ”¾å› å­
            originalDimensions = { 
                width: imageDimensions[puzzleImage].width * scaleFactor, 
                height: imageDimensions[puzzleImage].height * scaleFactor 
            }; // æ›´æ–°å°ºå¯¸
        } else {
            piecesCount = 36; // é è¨­ç‚º 6x6 æ‹¼åœ–
            puzzleFolder = 'Puzzle_2'; // æ›´æ–°è³‡æ–™å¤¾
            puzzleImage = 'AceofDiamond'; // æ›´æ–°åœ–ç‰‡å
            const scaleFactor = originalDimensions.width / imageDimensions[puzzleImage].width; // è¨ˆç®—ç¸®æ”¾å› å­
            originalDimensions = { 
                width: imageDimensions[puzzleImage].width * scaleFactor, 
                height: imageDimensions[puzzleImage].height * scaleFactor 
            }; // æ›´æ–°å°ºå¯¸
        }
    }
    initializePuzzle(); // é‡æ–°åˆå§‹åŒ–æ‹¼åœ–
}

// æ·»åŠ æ»‘é¼ æ‹–å‹•åŠŸèƒ½
function addDragFunctionality(piece) {
    let startX, startY, initialX, initialY;

    piece.addEventListener("mousedown", (e) => {
        startX = e.clientX;
        startY = e.clientY;
        initialX = parseInt(piece.style.left, 10);
        initialY = parseInt(piece.style.top, 10);

        piece.style.cursor = "grabbing";

        document.addEventListener("mousemove", onMouseMove);
        document.addEventListener("mouseup", onMouseUp);
    });

    function onMouseMove(e) {
        const dx = e.clientX - startX;
        const dy = e.clientY - startY;
        piece.style.left = `${initialX + dx}px`;
        piece.style.top = `${initialY + dy}px`;
    }

    function onMouseUp() {
        piece.style.cursor = "grab";
        document.removeEventListener("mousemove", onMouseMove);
        document.removeEventListener("mouseup", onMouseUp);
        snapToGrid(piece);
        checkPuzzleCompletion();
    }
}

// å°‡æ‹¼åœ–å¡Šå°é½Šåˆ°ç¶²æ ¼
function snapToGrid(piece) {
    const x = parseInt(piece.style.left, 10);
    const y = parseInt(piece.style.top, 10);

    const gridSize = Math.sqrt(piecesCount);
    const gridX = Math.round(x / (originalDimensions.width / gridSize)) * (originalDimensions.width / gridSize);
    const gridY = Math.round(y / (originalDimensions.height / gridSize)) * (originalDimensions.height / gridSize);

    piece.style.left = `${gridX}px`;
    piece.style.top = `${gridY}px`;
}

// å®Œæˆæ‹¼åœ–æª¢æŸ¥
function checkPuzzleCompletion() {
    const pieces = document.querySelectorAll(".puzzle-piece");
    let completed = true;

    pieces.forEach((piece) => {
        const index = parseInt(piece.dataset.index, 10) - 1;
        const gridSize = Math.sqrt(piecesCount);
        const correctX = (index % gridSize) * (originalDimensions.width / gridSize);
        const correctY = Math.floor(index / gridSize) * (originalDimensions.height / gridSize);

        const currentX = parseInt(piece.style.left, 10);
        const currentY = parseInt(piece.style.top, 10);

        // è¼¸å‡ºç•¶å‰èˆ‡æ­£ç¢ºä½ç½®çš„å°æ¯”
        console.log(`Piece ${index + 1}: Current Position = (${currentX}, ${currentY}), Correct Position = (${correctX}, ${correctY})`);

        // ä½¿ç”¨ä¸€å€‹å°çš„å®¹å¿ç¯„åœä¾†åˆ¤æ–·ä½ç½®æ˜¯å¦åŒ¹é…
        const tolerance = 1; // å®¹å¿ç¯„åœ

        if (Math.abs(currentX - correctX) > tolerance || Math.abs(currentY - correctY) > tolerance) {
            completed = false;
        }
    });

    if (completed) {
        document.getElementById("puzzle-status").style.display = "block";

        // é¡¯ç¤ºæç¤ºå­—
        const hintMessage = document.getElementById("hint-message-3");
        hintMessage.style.display = "block"; // é¡¯ç¤ºæç¤ºä¿¡æ¯
        
        // æ·»åŠ æ·¡å…¥æ•ˆæœ
        hintMessage.style.opacity = 0; // åˆå§‹åŒ–é€æ˜åº¦
        hintMessage.style.transition = "opacity 0.5s ease"; // éæ¸¡æ•ˆæœ

        // æ›´æ–°æç¤ºå…§å®¹
        hintMessage.innerHTML = 'æ­å–œä½ å®Œæˆæ‹¼åœ–ï¼ä»Šå¤©çš„æç¤ºè©æ˜¯: <span id="hint-word-3">' + document.getElementById("hint-word-3").textContent + '</span>ã€‚';

        // é¡¯ç¤ºæç¤ºæ™‚æ·¡å…¥
        setTimeout(() => {
            hintMessage.style.opacity = 1; // å®Œå…¨å¯è¦‹
        }, 10); // ç¢ºä¿æ·¡å…¥æ•ˆæœ

        // åœ¨ä¸€æ®µæ™‚é–“å¾Œéš±è—æç¤º
        setTimeout(() => {
            hintMessage.style.opacity = 0; // é–‹å§‹æ·¡å‡º
            setTimeout(() => {
                hintMessage.style.display = "none"; // éš±è—æç¤º
            }, 500); // ç­‰å¾…æ·¡å‡ºå®Œæˆ
        }, 3000); // 3ç§’å¾Œæ·¡å‡º
    }
}





// åœ–ç‰‡é¸æ“‡åŠŸèƒ½
document.querySelectorAll('.selectable-image').forEach(image => {
    image.addEventListener('click', () => {
        puzzleImage = image.dataset.image; // æ›´æ–°åœ–ç‰‡å
        if (puzzleImage === 'InuYasha') {
            changePuzzleSize('5x5'); // é¸æ“‡ InuYasha æ™‚è¨­ç½®ç‚º 5x5 æ‹¼åœ–
        } else {
            changePuzzleSize('6x6'); // å…¶ä»–åœ–ç‰‡è¨­ç½®ç‚º 6x6 æ‹¼åœ–
        }
    });
});


function shufflePuzzle() {
    initializePuzzle(); // é‡æ–°åˆå§‹åŒ–æ‹¼åœ–
    document.getElementById("puzzle-status").style.display = "none"; // éš±è—å®Œæˆè¨Šæ¯
}


// åˆå§‹åŒ–æ‹¼åœ–
initializePuzzle();










</script>




</body>
</html>
