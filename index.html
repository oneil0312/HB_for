<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>靖彤生日倒數計時器</title>
  <link rel="stylesheet" href="styles.css">  
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>
<body>
<div id="arcade-frame">
<label for="test-date">選擇測試日期:</label>
  <input type="date" id="test-date" onchange="setTestDate()">
<section id="countdown">
  <h1>Teacher Avery 生日倒數計時器</h1>
  <div id="digital-clock">
    <div class="digit">
      <span class="digit-label">天</span>
      <span id="days" class="digit-value">00</span>
    </div>
    <div class="digit">
      <span class="digit-label">時</span>
      <span id="hours" class="digit-value">00</span>
    </div>
    <div class="digit">
      <span class="digit-label">分</span>
      <span id="minutes" class="digit-value">00</span>
    </div>
    <div class="digit">
      <span class="digit-label">秒</span>
      <span id="seconds" class="digit-value">00</span>
    </div>
  </div>

  <div id="warning-button">
    <button id="count-button" class="warning-btn">沒用按鈕次數: <span id="click-count">0</span></button>    
  </div>
  
    <div class="calendar-container">
        <img src="IMG/Sagittarius.jpg" alt="Sagittarius" class="sagittarius-image left">
        <img src="December.png" alt="Calendar" class="calendar-image">
        <img src="IMG/Sagittarius.jpg" alt="Sagittarius" class="sagittarius-image right">
        <div class="date-circle"></div> <!-- 紅色圓圈 -->
    </div>
  
	<img src="causon_bread.png" alt="causon_bread" class="causon_bread" onclick="playSound()">
	<audio id="clickSound">
		<source src="causon.mp3" type="audio/mpeg">
	</audio>

	<img src="causon.png" alt="causon" class="causon" id="causonImage" style="display: none;">

  
  
<section class="level-selector">
  <div class="level-card" onclick="showGame(1)">
    <h2>關卡 1</h2>    
    <p id="level1-countdown">常駐開啟!</p>
  </div>

  <div class="level-card" id="level-2" onclick="checkLevel2Access()">
    <h2>關卡 2</h2>    
    <p id="level2-countdown">還剩 <span id="level2-days">3</span> 天 開啟</p> <!-- 倒數計時顯示 -->
    <p id="limited-access-message" style="display: none;">關卡限時開放中!</p> <!-- 限時開放消息 -->
  </div>

  <div class="level-card" id="level-3" onclick="checkLevel3Access()">
    <h2>關卡 3</h2>    
    <p id="level3-countdown">還剩 <span id="level3-days">5</span> 天 開啟</p> <!-- 倒數計時顯示 -->
    <p id="limited-access-message-3" style="display: none;">關卡限時開放中!</p> <!-- 限時開放消息 -->
  </div>
</section>


<div id="hint-message" style="display: none;">今天的提示字是: <span id="hint-word">Re</span>。</div>
<div id="hint-message-3" style="display: none;" class="hint-message">
    今天的提示字是: <span id="hint-word-3">la</span>。
</div>
<!-- 三個不同的遊戲區域 -->
<section id="game1" class="game-area" style="display: none;">
  <section id="game-section">
    <h2 class="game-title-modern"><span>關卡 1 -音樂</span> 消消樂</h2>

    <div class="score-container">
      <p class="score-display">分數: <span id="score">0</span></p> <!-- 顯示分數 -->
    </div>

    <div id="memory-game" class="memory-game">
      <!-- 這裡的卡片將通過 JavaScript 動態生成 -->
    </div>

    <label for="volumeControl">音量:</label>
    <input type="range" id="volumeControl" min="0" max="1" step="0.01" value="0.1">
    <button id="restart-button" class="restart-btn" style="display: none;">重新洗牌</button>
  </section>

  <div id="message-container" style="display: none;">
    <p id="message-text"></p>
    <button id="close-button">確認</button>
  </div>
</section>

<section id="game2" class="game-area" style="display: none;">
  <h3 class="game-title">關卡 2 - 問答遊戲</h3>
  <div id="quiz-container" class="quiz-container">
    <p id="question-number">第 <span id="current-question-number">1</span> 題 / 總共 10 題</p>
    <p id="question">請回答問題</p>
	<div class="answer-row">
		<button class="answer-button" onclick="checkAnswer('A')">A. 答案 A</button>
		<button class="answer-button" onclick="checkAnswer('B')">B. 答案 B</button>
	</div>
	<div class="answer-row">
		<button class="answer-button" onclick="checkAnswer('C')">C. 答案 C</button>
		<button class="answer-button" onclick="checkAnswer('D')">D. 答案 D</button>
	</div>
    <p id="feedback"></p>
    <p id="score">答對題數: <span id="correct-count">0</span> / 10</p>
  </div>

  <!-- 重新開始按鈕 -->
  <button id="restartButton" class="restart-btn" onclick="restartQuiz()">重新開始</button>

  <audio id="correctSound">
    <source src="voice/Correct.mp4" type="audio/mp4">
  </audio>
  <audio id="wrongSound">
    <source src="voice/wrong.mp4" type="audio/mp4">
  </audio>
</section>

<section id="game3" class="game-area" style="display: none;">
  <h3>這是關卡 3 - 拼圖遊戲(拼圖可以放在外面喔)</h3>
  
  <!-- 圖片選擇器 -->
  <div id="image-selector">
      <h4>選擇要拼的圖片:</h4>
      <img src="IMG/Puzzle_1/InuYasha.jpg" alt="InuYasha" data-image="InuYasha" class="selectable-image" />
      <img src="IMG/Puzzle_2/AceofDiamond.jpg" alt="Ace of Diamond" data-image="AceofDiamond" class="selectable-image" />
      <img src="IMG/Puzzle_3/Konan.jpg" alt="Konan" data-image="Konan" class="selectable-image" /> <!-- 新增的圖片 -->
  </div>

  <div class="puzzle-container" id="puzzleContainer">
    <!-- 拼圖小塊將通過 JavaScript 動態生成 -->
  </div>
  
  <div class="original-puzzle">
    <img src="IMG/Puzzle_1/InuYasha.jpg" alt="完整的拼圖" />
  </div>

  <p id="puzzle-status" style="display: none;">恭喜你完成拼圖！</p>
  <button onclick="shufflePuzzle()">重新洗牌</button>
</section>



<div style="text-align: center;">
  <a href="HB_for_avery.html">
    <img id="birthday-image" src="IMG/door.jpg" alt="Birthday Image" style="display: none; width: 300px; height: auto;">
  </a>
</div>
</div>
    <footer>
        <p>© 歐尼歐版權大概吧</p>
    </footer>

<script>
// 當點擊 causon_bread 時執行的函數
function playSound() {
    var audio = document.getElementById("clickSound");
    audio.volume = 0.3;
    audio.play();

    // 顯示 causon.png 圖片並啟動動畫
    var causonImage = document.getElementById("causonImage");
    causonImage.style.display = 'block';  // 顯示圖片
    causonImage.classList.add('animate');  // 添加動畫效果

    // 在動畫結束後將圖片隱藏
    setTimeout(function() {
        causonImage.style.display = 'none';  // 重新隱藏圖片
        causonImage.classList.remove('animate');  // 移除動畫效果以便下一次重新執行
    }, 3000); // 3秒後隱藏圖片
}

function checkLevel2Access() {
  var days = parseInt(document.getElementById('days').textContent);
  if (days < 2) {
    showGame(2); // 顯示第二關
  } else {
    alert("第二關尚未開啟，請耐心等候！");
  }
}

function checkLevel3Access() {
  var days = parseInt(document.getElementById('days').textContent);
  if (days < 1) { // 檢查剩餘天數是否小於1
    showGame(3); // 顯示第三關
  } else {
    alert("第三關尚未開啟，請耐心等候！");
  }
}

// 倒數日期
var countdownDate = new Date('2024-12-08').getTime();
var clickCount = 0; // 點擊計數器
var secondPhaseOpened = false; // 記錄第二關是否已開啟
var thirdPhaseOpened = false; // 關卡 3 的狀態

function setTestDate() {
  var selectedDate = document.getElementById('test-date').value;
  if (selectedDate) {
    countdownDate = new Date(selectedDate).getTime(); // 更新倒數日期為選擇的測試日期
    updateCountdown(); // 更新倒數計時
  }
}
// 格式化顯示日期數字
function padZero(num) {
  return num < 10 ? '0' + num : num;
}

// 更新倒數計時器
function updateCountdown() {
  var now = new Date().getTime();
  var distance = countdownDate - now;

  var days = Math.floor(distance / (1000 * 60 * 60 * 24));
  var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
  var seconds = Math.floor((distance % (1000 * 60)) / 1000);

  // 更新數字顯示
  document.getElementById('days').textContent = padZero(days);
  document.getElementById('hours').textContent = padZero(hours);
  document.getElementById('minutes').textContent = padZero(minutes);
  document.getElementById('seconds').textContent = padZero(seconds);

  // 倒數結束時顯示生日圖片
  if (distance <= 0) {
    clearInterval(countdownInterval);
    document.getElementById('birthday-image').style.display = 'block';
  } else if (days < 2) {
    showCatAnimation();
  }

  // 更新關卡2中的倒數顯示，並將 days 減去 2
  var remainingDaysLevel2 = days - 2;
  document.getElementById('level2-countdown').textContent = `還剩 ${remainingDaysLevel2} 天 開啟`;

  // 當剩餘時間小於二天時開啟第二關
  console.log("Days until birthday: " + days);
  if (days < 2 && !secondPhaseOpened) {
    secondPhaseOpened = true; // 設置為已開啟
    document.getElementById('level-2').style.display = 'block'; // 顯示第二關內容
    document.getElementById('level2-countdown').style.display = 'none'; // 隱藏倒數顯示
    document.getElementById('limited-access-message').style.display = 'block'; // 顯示限時開放的消息
    console.log("Second phase opened!");
  }

  // 更新關卡3中的倒數顯示，並將 days 減去 1
  var remainingDaysLevel3 = days - 1;
  document.getElementById('level3-countdown').textContent = `還剩 ${remainingDaysLevel3} 天 開啟`;

	// 當剩餘時間小於一天時開啟第三關
	if (remainingDaysLevel3 < 1 && !thirdPhaseOpened) {
	  thirdPhaseOpened = true; // 設置為已開啟
	  document.getElementById('level-3').style.display = 'block'; // 顯示第三關內容
	  document.getElementById('level3-countdown').style.display = 'none'; // 隱藏倒數顯示
	  document.getElementById('limited-access-message-3').style.display = 'block'; // 顯示限時開放的消息
	  console.log("Third phase opened!");
	}
}



// 輔助函數：補零
function padZero(num) {
  return num < 10 ? '0' + num : num;
}

// 開始倒數計時
var countdownInterval = setInterval(updateCountdown, 1000);

// 更新點擊計數並顯示對話框
document.getElementById("count-button").addEventListener("click", function() {
  clickCount++;
  document.getElementById("click-count").textContent = clickCount;

  if (clickCount >= 100) {
    alert("恭喜你離生日又更近一點了!");
    clickCount = 0; // 重新歸零
    document.getElementById("click-count").textContent = clickCount; // 更新顯示
  }
});

function showCatAnimation() {
  var catImage = document.createElement('img');
  catImage.src = 'https://img.cgmodel.com/image/2020/0627/big/38830-614463665.gif';
  catImage.style.width = '150px';
  catImage.style.position = 'fixed';
  catImage.style.bottom = '20px';
  catImage.style.left = '-100px';
  catImage.style.animation = 'run-animation 5s linear forwards';
  document.body.appendChild(catImage);
  catImage.addEventListener('animationend', function() {
    catImage.remove();
  });
}

// 顯示特定遊戲
function showGame(gameNumber) {
  // 隱藏所有遊戲區域
  document.getElementById('game1').style.display = 'none';
  document.getElementById('game2').style.display = 'none';
  document.getElementById('game3').style.display = 'none';
  
  // 顯示對應的遊戲區域
  document.getElementById('game' + gameNumber).style.display = 'block';
}

// 啟動倒數計時器
var countdownInterval = setInterval(updateCountdown, 1000);









// 消消樂歌曲和圖片的對應關係
const songs = [
    { song: 'voice/yuuri_BETELGEUSE.MP3', framework: 'yuuri_BETELGEUSE' },
    { song: 'voice/Aimer_HoshikuzuVenus.MP3', framework: 'Aimer_HoshikuzuVenus' },
    { song: 'voice/Aimer_Kataomoi.MP3', framework: 'Aimer_Kataomoi' },
    { song: 'voice/Aimer_RokutouseinoYoru.MP3', framework: 'Aimer_RokutouseinoYoru' },
    { song: 'voice/Aimer_ShiroiroKagerou.MP3', framework: 'Aimer_ShiroiroKagerou' },
	{ song: 'voice/Spyair_Orange.MP3', framework: 'Spyair_Orange' },
	{ song: 'voice/yuuri_Leo.MP3', framework: 'yuuri_Leo' },
	{ song: 'voice/yoasobi_blue.MP3', framework: 'yoasobi_blue' },
	{ song: 'voice/yoasobi_monster.MP3', framework: 'yoasobi_monster' },
	{ song: 'voice/yorushika_Algernon.MP3', framework: 'yorushika_Algernon' },
	{ song: 'voice/yorushika_Tadakiminohare.MP3', framework: 'yorushika_Tadakiminohare' },
    { song: 'voice/yuuri_DriedFlowers.MP3', framework: 'yuuri_DrideFlowers' },
	{ song: 'voice/ChoQmay_Anata No Koibito Ni Naritai.MP3', framework: 'ChoQmay_Anata No Koibito Ni Naritai' },
	{ song: 'voice/Rokudenashi_One Voice.MP3', framework: 'Rokudenashi_One Voice' },
	{ song: 'voice/milet, Aimer, Lilas Ikuta_Omokage.MP3', framework: 'milet, Aimer, Lilas Ikuta_Omokage' },
];


const yorushikaSongs = [
    { song: 'voice/yorushika_Algernon.MP3', framework: 'yorushika_Algernon' },
    { song: 'voice/yorushika_Tadakiminohare.MP3', framework: 'yorushika_Tadakiminohare' },
    { song: 'voice/yorushika_yusansan.MP3', framework: 'yorushika_yusansan' },
    { song: 'voice/yorushika_thoughtcrime.MP3', framework: 'yorushika_thoughtcrime' },
    { song: 'voice/yorushika_sayit.MP3', framework: 'yorushika_sayit' },
    { song: 'voice/yorushika_Plagiarism.MP3', framework: 'yorushika_Plagiarism' },
	{ song: 'voice/yorushika_harudorobou.MP3', framework: 'yorushika_harudorobou' },
	{ song: 'voice/yorushika_hananibourei.MP3', framework: 'yorushika_hananibourei' },	
	{ song: 'voice/yorushika_dakarabokuwaongakuwoyameta.MP3', framework: 'yorushika_dakarabokuwaongakuwoyameta' },	
	{ song: 'voice/yorushika_aporia.MP3', framework: 'yorushika_aporia' },
	{ song: 'voice/yorushika_leftrightconfusion.MP3', framework: 'yorushika_leftrightconfusion' },		
];



function addYorushikaImage() {
    const memoryGame = document.getElementById('memory-game');

    // 檢查是否已經有 Yorushika 卡片，如果有則不再插入
    if (!document.querySelector('.yorushika-card')) {
        const yorushikaCard = `
            <div class="yorushika-card-container">
                <div class="yorushika-card">
                    <img src="IMG/yorushika.jpg" alt="Yorushika Special Level" />
                </div>
            </div>
        `;

        memoryGame.insertAdjacentHTML('beforeend', yorushikaCard);

        // 為Yorushika卡片添加點擊事件，點擊後切換到Yorushika專屬關卡
        document.querySelector('.yorushika-card').addEventListener('click', () => {
            initYorushikaLevel(); // 切換到Yorushika專屬關卡
            showYorushikaMessage(); // 顯示提示訊息
            showResetButton(); // 顯示還原按鈕
        });
    }
}



// 顯示提示訊息的函數
function showYorushikaMessage() {
    const messageContainer = document.createElement('div');
    messageContainer.classList.add('yorushika-message');  // 增加樣式類

    // 使用 <p> 分開提示文字
    messageContainer.innerHTML = `
        <p>已切換到yorushika特殊難度</p>
        <p>中間的音樂都會是yorushika的歌曲</p>
    `;

    // 設置文字顏色為Yorushika風格的藍紫色
    messageContainer.style.color = '#b0a0e2'; // 淺紫色

    // 將提示訊息添加到頁面
    document.body.appendChild(messageContainer);

    // 設置提示訊息顯示一段時間後消失
    setTimeout(() => {
        messageContainer.remove();
    }, 4000); // 4秒後提示消息消失
}





// 隨機選擇 Yorushika 歌曲
function selectYorushikaSongs() {
    const shuffledYorushikaSongs = yorushikaSongs.sort(() => 0.5 - Math.random());
    selectedSongs = shuffledYorushikaSongs.slice(0, 4); // 取前4首
}


// 初始化Yorushika專屬關卡
function initYorushikaLevel() {
    selectYorushikaSongs(); // 選擇Yorushika的四首歌曲
    generateCards(); // 根據選擇的歌曲生成卡片
    addCardListeners(); // 添加卡片點擊事件
    shuffle(); // 隨機打亂卡片
}




let selectedSongs = [];

// 隨機選擇四組歌曲
function selectSongs() {
    const shuffledSongs = songs.sort(() => 0.5 - Math.random());
    selectedSongs = shuffledSongs.slice(0, 4); // 取前4組
}

// 修改generateCards函數，使其能根據所選歌曲生成對應的卡片
function generateCards() {
    const memoryGame = document.getElementById('memory-game');
    memoryGame.innerHTML = ''; // 清空遊戲區域

    const cardsHtml = selectedSongs.flatMap(song => [
        `<div class="memory-card" data-framework="${song.framework}">
            <img class="front-face" src="IMG/music_img.jpg" alt="${song.framework}" />
            <div class="back-face"></div>
        </div>`,
        `<div class="memory-card" data-framework="${song.framework}">
            <img class="front-face" src="IMG/${song.framework}.jpg" alt="${song.framework}" />
            <div class="back-face"></div>
        </div>`
    ]).join('');
    
    memoryGame.innerHTML = cardsHtml;
}

// 初始化普通關卡，並加上Yorushika圖片
function initGame() {
    selectSongs(); // 選擇新的四首歌曲
    generateCards(); // 根據選擇的歌曲生成卡片
    addCardListeners(); // 添加卡片點擊事件
    shuffle(); // 隨機打亂卡片
    addYorushikaImage(); // 添加Yorushika專屬圖片
}

// 消消樂邏輯
let hasFlippedCard = false;
let lockBoard = false;
let firstCard, secondCard;
let score = 00; // 分數初始化
let audio; // 聲音變數

const volumeControl = document.getElementById('volumeControl'); // 獲取音量控制元素

function flipCard() {
    if (lockBoard) return; // 如果遊戲板被鎖定，則不允許點擊
    if (this === firstCard) return;

    this.classList.add('flipped');

    // 檢查是否點擊的是有音樂的卡片
    const imgElement = this.querySelector('.front-face');
    if (imgElement && imgElement.getAttribute('src').includes('music_img.jpg')) {
        if (audio) {
            audio.pause(); // 如果有正在播放的音樂，則停止
            audio.currentTime = 0; // 重置時間
        }

        // 根據框架名稱選擇對應的音樂
        const selectedSong = selectedSongs.find(song => song.framework === this.dataset.framework);
        if (selectedSong) {
            audio = new Audio(selectedSong.song); // 播放對應音樂
			audio.volume = volumeControl.value; // 使用音量控制條當前值
            audio.play().catch(err => {
                console.error('音樂播放錯誤:', err);  // 捕獲播放錯誤
            });
        }
    }

    if (!hasFlippedCard) {
        hasFlippedCard = true;
        firstCard = this;
        return;
    }

    secondCard = this;

    // 短暫延遲後檢查是否匹配
    setTimeout(checkForMatch, 300); // 增加延遲，讓翻開的卡片更明顯
}

// 監聽音量控制滑動條，動態調整音量
volumeControl.addEventListener('input', function() {
    if (audio) {
        audio.volume = this.value;  // 動態調整音量
    }
});


function checkForMatch() {
    let isMatch = firstCard.dataset.framework === secondCard.dataset.framework;

    if (isMatch) {
        disableCards(); // 鎖定卡片
        // 取得歌曲名稱和歌手名稱
        const selectedSong = selectedSongs.find(song => song.framework === firstCard.dataset.framework);
        
        // 提取歌名和歌手名
        const songName = selectedSong.framework.split('_')[1]; // 提取下劃線後的部分
        const singerName = selectedSong.song.split('/')[1].split('_')[0]; // 從文件名提取歌手名
        
        // 顯示匹配成功的消息
        showMatchMessage(songName, singerName);
        
    } else {
        unflipCards(); // 如果不匹配，則翻回去
    }
}

function showMatchMessage(songName, artist) {
    // 鎖定遊戲板
    lockBoard = true;

    // 創建覆蓋層
    const overlay = document.createElement('div');
    overlay.id = 'overlay';
    overlay.style.position = 'fixed';
    overlay.style.top = '0';
    overlay.style.left = '0';
    overlay.style.width = '100%';
    overlay.style.height = '100%';
    overlay.style.backgroundColor = 'rgba(0, 0, 0, 0.5)'; // 半透明背景
    overlay.style.zIndex = '999'; // 確保在最上面
    document.body.appendChild(overlay);

    const matchMessage = document.createElement('div');
    matchMessage.id = 'match-message';
    matchMessage.innerHTML = `
        <div class="match-message-content">
            <p>🎉 恭喜你答對了!! 🎉</p>
            <p>歌名為: "${songName}"</p>
            <p>歌手為: "${artist}"</p>
            <button id="confirm-button">確認 <span class="small-text">(請等後方卡片消失再按)</span></button>
        </div>
    `;
    document.body.appendChild(matchMessage);

    // 點擊確認按鈕時，關閉提示視窗和覆蓋層
    document.getElementById('confirm-button').addEventListener('click', () => {
        document.body.removeChild(matchMessage); // 移除提示視窗
        document.body.removeChild(overlay); // 移除覆蓋層
        lockBoard = false; // 確認後解鎖遊戲板
        resetBoard(); // 重置翻牌狀態

        // 檢查分數是否達到10分，顯示提示訊息
        if (score === 10) {
            showHintPopup(); // 顯示提示字的彈窗
        }
    });
}

function showHintPopup() {
    // 創建提示彈窗
    const hintPopup = document.createElement('div');
    hintPopup.id = 'hint-popup';
    hintPopup.innerHTML = `
        <div class="hint-popup-content">
            <p style="color: #ff4081;"> 今天的提示字是: <strong style="color: #ff4081;">RE</strong> </p>
            <button class="hint-confirm-button">確認</button>
        </div>
    `;
    
    document.body.appendChild(hintPopup);

    // 點擊確認按鈕時，關閉提示彈窗
    const confirmButton = hintPopup.querySelector('.hint-confirm-button');
    confirmButton.addEventListener('click', () => {
        document.body.removeChild(hintPopup); // 移除提示彈窗
    });
}





function disableCards() {
    score++; // 增加分數
    document.getElementById('score').textContent = score; // 更新分數顯示

    lockBoard = true; // 鎖定遊戲板，禁止點擊其他卡片

    setTimeout(() => {
        firstCard.style.visibility = 'hidden'; // 隱藏配對的第一張卡片
        secondCard.style.visibility = 'hidden'; // 隱藏配對的第二張卡片
        checkGameOver(); // 檢查是否所有牌都已消除
        resetBoard();
        lockBoard = false; // 在配對後重新解鎖遊戲板
    }, 1000);
}






function unflipCards() {
    lockBoard = true; // 鎖定遊戲板
    if (audio) {
        audio.pause(); // 停止音樂
        audio.currentTime = 0; // 重置音樂到起始位置
    }

    setTimeout(() => {
        firstCard.classList.remove('flipped');
        secondCard.classList.remove('flipped');
        resetBoard();
        lockBoard = false; // 在翻轉後重新解鎖遊戲板
    }, 1500);
}

function resetBoard() {
    [hasFlippedCard, lockBoard] = [false, false];
    [firstCard, secondCard] = [null, null];
}

function updateScore() {    
    document.getElementById('score').textContent = score;
}

// 隨機打亂卡片
function shuffle() {
    const cards = document.querySelectorAll('.memory-card');
    cards.forEach(card => {
        let randomPos = Math.floor(Math.random() * 12);
        card.style.order = randomPos;
    });
}

// 為卡片添加點擊事件監聽器
function addCardListeners() {
    const cards = document.querySelectorAll('.memory-card');
    cards.forEach(card => card.addEventListener('click', flipCard));
}

// 檢查遊戲是否結束
function checkGameOver() {
    const remainingCards = document.querySelectorAll('.memory-card:not([style*="visibility: hidden"])');
    if (remainingCards.length === 0) {
        document.getElementById('restart-button').style.display = 'block'; // 顯示重新開始按鈕
    }
}





// 當用戶點擊確認按鈕時隱藏訊息
document.getElementById('close-button').addEventListener('click', () => {
    document.getElementById('message-container').style.display = 'none';
});


// 重新開始遊戲邏輯
document.getElementById('restart-button').addEventListener('click', () => {    
    initGame(); // 重新初始化遊戲
    document.getElementById('restart-button').style.display = 'none'; // 隱藏重新開始按鈕
});

initGame(); // 初次加載遊戲







const questions = [
  {
    question: "Aimer 的哪一首歌曲是動畫《Fate/stay night》UBW 的片尾曲？",
    options: { A: "Brave Shine", B: "Kataomoi", C: "Rokutousei no Yoru", D: "Ref:rain" },
    answer: "A"
  },
    {
    question: "怪盜基德的首次登場是在《名偵探柯南》的第幾集？",
    options: { A: "第50集", B: "第76集", C: "第125集", D: "第219集" },
    answer: "B"
  },
    {
    question: "灰原哀的本名是什麼？",
    options: { A: "宮野明美", B: "宮野志保", C: "工藤有希子", D: "妃英理" },
    answer: "B"
  },
   {
    question: "《名偵探柯南》的作者是誰？",
    options: { A: "青山剛昌", B: "鳥山明", C: "岸本齊史", D: "尾田榮一郎" },
    answer: "A"
  },
   {
    question: "怪盜基德的真實身份是誰？",
    options: { A: "服部平次", B: "工藤新一", C: "黑羽快斗", D: "白馬探" },
    answer: "C"
  },
    {
    question: "降谷 暁（ふるや さとる）的投球風格主要以什麼為特點？",
    options: { A: "快速球", B: "曲球", C: "變速球", D: "指叉球" },
    answer: "A"
  },
    {
    question: "小湊 春市（こみなと はるいち）的特長是什麼？",
    options: { A: "打擊", B: "守備", C: "跑壘", D: "戰術" },
    answer: "A"
  },
   {
    question: "哪位角色擔任青道高校的捕手？",
    options: { A: "倉持 洋一（くらもち よういち）", B: "小湊 春市（こみなと はるいち）", C: "降谷 暁（ふるや さとる)", D: "御幸 一也（みゆき かずや）" },
    answer: "D"
  },
    {
    question: "怪盜基德通常會事先給警方送什麼來預告他的行動？",
    options: { A: "畫像", B: "電子郵件", C: "挑戰信", D: "寶石樣品" },
    answer: "C"
  },
   {
    question: "工藤新一當初被灌下的藥劑名稱是什麼？",
    options: { A: "APTX 4869", B: "VX 3000", C: "XK-500", D: "MDX-900" },
    answer: "A"
  },
   {
    question: "怪盜基德的目標通常是什麼類型的物品？",
    options: { A: "古董", B: "珠寶和寶石", C: "文書文件", D: "藝術品" },
    answer: "B"
  },
  {
    question: "Yuuri 的哪一首歌曲讓他迅速成名，並登上排行榜？",
    options: { A: "BETELGEUSE", B: "Dried Flowers", C: "Infinity", D: "Leo" },
    answer: "B"
  },
  {
    question: "Yoasobi 的哪一首歌被用作《BEASTARS》第二季的片頭曲？",
    options: { A: "Yoru ni Kakeru", B: "Ano Yume o Nazotte", C: "Kaibutsu", D: "Halzion" },
    answer: "C"
  },
  {
    question: "Yorushika 的主唱 n-buna 與誰共同組成了樂隊？",
    options: { A: "Hoshino Gen", B: "Ikuta Lilas", C: "suis", D: "Aimer" },
    answer: "C"
  },
  {
    question: "Aimer 的第一張專輯名稱是什麼？",
    options: { A: "Midnight Sun", B: "Sleepless Nights", C: "Daydream", D: "After Dark" },
    answer: "B"
  },
  {
    question: "Yoasobi 的首張數位單曲《Yoru ni Kakeru》是改編自哪部小說？",
    options: { A: "夢の雫と星の花", B: "ヤメゴク", C: "タナトスの誘惑", D: "タイムマシン" },
    answer: "A"
  },
  {
    question: "Yorushika 的哪一首歌曲以「忘記愛人」的主題為背景？",
    options: { A: "春泥棒", B: "夜行", C: "花に亡霊", D: "だから僕は音楽を辞めた" },
    answer: "A"
  },
  {
    question: "Yoasobi 的歌曲「夜に駆ける」描述的是什麼主題？",
    options: { A: "孤獨", B: "愛情", C: "懷舊", D: "夢想" },
    answer: "A"
  },
    {
    question: "在柯南的故事中，黑暗組織的代號『琴酒』的搭檔是誰？",
    options: { A: "雪莉", B: "伏特加", C: "基爾", D: "雷利" },
    answer: "B"
  },
  {
    question: "Yorushika 的哪首歌以「旅途」為主題？",
    options: { A: "Sora ni Utaeba", B: "Hikaru Nara", C: "Hana ni Arashi", D: "Hikaru" },
    answer: "C"
  },
  {
    question: "Yorushika 的主唱是哪位音樂人？",
    options: { A: "Aimer", B: "n-buna", C: "Yuuri", D: "Ayase" },
    answer: "B"
  },
  {
    question: "Aimer 在哪一年首次出道？",
    options: { A: "2011年", B: "2012年", C: "2013年", D: "2014年" },
    answer: "A"
  },
  {
    question: "Aimer 的哪一首歌曲是《Koi wa Ameagari no You ni》的片尾曲？",
    options: { A: "StarRingChild", B: "I beg you", C: "Ref:rain", D: "Zero" },
    answer: "C"
  },
   {
    question: "Yoasobi 的歌曲「Haruka」是根據哪部作品改編的？",
    options: { A: "小説《怪談》", B: "小説《月王子》", C: "小説《大兔子》", D: "小説《不幸的流浪者》" },
    answer: "B"
  },
  {
    question: "在 Yoasobi 中，哪位成員負責作曲和編曲？",
    options: { A: "Aimer", B: "Ayase", C: "n-buna", D: "Yuuri" },
    answer: "B"
  },
];


// 隨機選擇 10 題
function selectRandomQuestions(allQuestions, num) {
  const shuffled = [...allQuestions].sort(() => 0.5 - Math.random());
  return shuffled.slice(0, num);
}



let currentQuestionIndex = 0; // 當前問題的索引
let correctCount = 0; // 答對題數
let answeringAllowed = true; // 控制是否可以回答
let selectedQuestions = selectRandomQuestions(questions, 10); // 隨機選擇的 10 題

// 顯示下一題
function displayNextQuestion() {
  if (currentQuestionIndex < selectedQuestions.length) { // 確認仍有問題可顯示
    const questionData = selectedQuestions[currentQuestionIndex]; // 獲取當前問題資料
    document.getElementById('current-question-number').textContent = currentQuestionIndex + 1; // 更新題號
    document.getElementById('question').textContent = questionData.question; // 更新問題內容

    // 更新選項文字
    document.getElementsByClassName('answer-button')[0].textContent = `A. ${questionData.options.A}`;
    document.getElementsByClassName('answer-button')[1].textContent = `B. ${questionData.options.B}`;
    document.getElementsByClassName('answer-button')[2].textContent = `C. ${questionData.options.C}`;
    document.getElementsByClassName('answer-button')[3].textContent = `D. ${questionData.options.D}`;
    
    document.getElementById('feedback').textContent = ""; // 清空反饋信息
  } else {
    // 顯示結果
    if (correctCount >= 6) {
      document.getElementById('quiz-container').innerHTML = `
        <div class="result-message success">
          <h2>恭喜！你答對了超過六題！</h2>
          <p>今天的提示字是: <strong>ga</strong></p> <!-- 顯示提示字 -->
        </div>
      `;
    } else {
      document.getElementById('quiz-container').innerHTML = `
        <div class="result-message failure">
          <h2>遊戲結束！很可惜，你未能答對六題。</h2>
          <p>再接再厲，下次會更好！</p>
        </div>
      `;
    }
  }
  answeringAllowed = true; // 允許回答下一題
}

// 檢查答案
function checkAnswer(selectedOption) {
  if (!answeringAllowed) return; // 如果不允許回答，則直接返回

  const questionData = selectedQuestions[currentQuestionIndex]; // 使用 selectedQuestions
  const feedbackElement = document.getElementById('feedback');
  const correctSound = document.getElementById('correctSound');
  const wrongSound = document.getElementById('wrongSound');

  answeringAllowed = false; // 禁止再次回答
  
  
  // 設定音效音量
  correctSound.volume = 0.1; // 設定正確音效音量
  wrongSound.volume = 0.1; // 設定錯誤音效音量

  if (selectedOption === questionData.answer) {
    correctCount++;
    feedbackElement.textContent = "回答正確！";
    feedbackElement.style.color = "green";
    correctSound.play();
  } else {
    feedbackElement.textContent = `回答錯誤！正確答案是: ${questionData.answer}.`;
    feedbackElement.style.color = "red";
    wrongSound.play();
  }

  // 更新答對題數顯示
  document.getElementById('correct-count').textContent = correctCount;

  // 移動到下一題
  currentQuestionIndex++;
  setTimeout(displayNextQuestion, 3000); // 等待 3 秒後顯示下一題
}

// 隨機化問題
function shuffleQuestions() {
  for (let i = questions.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [questions[i], questions[j]] = [questions[j], questions[i]];
  }
}

// 初始化遊戲
function startQuiz() {
  displayNextQuestion(); // 顯示第一題
}

function restartQuiz() {
  // 隨機選擇新的 10 題
  selectedQuestions = selectRandomQuestions(questions, 10); // 重新隨機選擇問題

  // 重置遊戲狀態
  currentQuestionIndex = 0;
  correctCount = 0;

  // 重置 UI 並準備開始新的遊戲
  document.getElementById('quiz-container').innerHTML = `
    <p id="question-number">第 <span id="current-question-number">1</span> 題 / 總共 10 題</p>
    <p id="question">請回答問題</p>
    <div class="answer-row">
      <button class="answer-button" onclick="checkAnswer('A')">A. 答案 A</button>
      <button class="answer-button" onclick="checkAnswer('B')">B. 答案 B</button>
    </div>
    <div class="answer-row">
      <button class="answer-button" onclick="checkAnswer('C')">C. 答案 C</button>
      <button class="answer-button" onclick="checkAnswer('D')">D. 答案 D</button>
    </div>
    <p id="feedback"></p>
    <p id="score">答對題數: <span id="correct-count">0</span> / 10</p>
  `;

  // 開始新的遊戲，顯示第一個問題
  displayNextQuestion();
}


// 呼叫開始遊戲的函數
startQuiz();




let piecesCount = 25; // 初始為 5x5 拼圖
let shuffledPositions = [];
let puzzleImage = 'InuYasha'; // 初始圖片
let puzzleFolder = 'Puzzle_1'; // 初始資料夾
let originalDimensions = { width: 800, height: 450 }; // 固定拼圖容器的尺寸

// 原始圖片尺寸
const imageDimensions = {
    'InuYasha': { width: 1280, height: 814 }, // 圖片 1
    'AceofDiamond': { width: 213, height: 136 }, // 圖片 2
    'Konan': { width: 267, height: 189 } // 圖片 3
};

// 初始化拼圖
function initializePuzzle() {
    const puzzleContainer = document.getElementById("puzzleContainer");
    puzzleContainer.innerHTML = ""; // 清空容器

    // 更新容器尺寸
    updatePuzzleContainerSize();

    shuffledPositions = generateShuffledPositions();

    for (let i = 1; i <= piecesCount; i++) {
        const piece = document.createElement("div");
        piece.classList.add("puzzle-piece");

        // 計算拼圖塊的尺寸
        const pieceWidth = (originalDimensions.width / Math.sqrt(piecesCount));
        const pieceHeight = (originalDimensions.height / Math.sqrt(piecesCount));

        piece.style.width = `${pieceWidth}px`;
        piece.style.height = `${pieceHeight}px`;

        piece.style.backgroundImage = `url('IMG/${puzzleFolder}/${puzzleImage}_${i}.jpg')`; // 更新路徑

        // 使用亂數位置
        const { x, y } = shuffledPositions[i - 1];
        piece.style.left = `${x}px`;
        piece.style.top = `${y}px`;

        piece.dataset.index = i;

        // 添加滑鼠拖動功能
        addDragFunctionality(piece);

        puzzleContainer.appendChild(piece);
    }

    // 更新完整拼圖的圖片
    updateOriginalPuzzleImage();
}

// 更新完整拼圖的圖片
function updateOriginalPuzzleImage() {
    const originalPuzzleImage = document.querySelector('.original-puzzle img');
    originalPuzzleImage.src = `IMG/${puzzleFolder}/${puzzleImage}.jpg`; // 更新完整拼圖路徑
}

// 更新拼圖容器的大小
function updatePuzzleContainerSize() {
    const puzzleContainer = document.querySelector(".puzzle-container");
    const gridSize = Math.sqrt(piecesCount);

    puzzleContainer.style.width = `${originalDimensions.width}px`; // 固定寬度
    puzzleContainer.style.height = `${(originalDimensions.height / gridSize) * gridSize}px`; // 高度根據行數計算
}

// 生成亂數位置
function generateShuffledPositions() {
    const positions = [];
    const gridSize = Math.sqrt(piecesCount); // 獲取行數

    for (let y = 0; y < gridSize; y++) {
        for (let x = 0; x < gridSize; x++) {
            positions.push({ x: x * (originalDimensions.width / gridSize), y: y * (originalDimensions.height / gridSize) }); // 使用拼圖塊的大小
        }
    }
    return positions.sort(() => Math.random() - 0.5);
}

// 更改拼圖尺寸
function changePuzzleSize(size) {
    if (size === '5x5') {
        piecesCount = 25; // 5x5 拼圖
        puzzleFolder = 'Puzzle_1'; // 更新資料夾
        puzzleImage = 'InuYasha'; // 更新圖片名
        originalDimensions = { width: 800, height: 450 }; // 更新尺寸
    } else if (size === '6x6') {
        if (puzzleImage === 'AceofDiamond') {
            piecesCount = 36; // 6x6 拼圖
            puzzleFolder = 'Puzzle_2'; // 更新資料夾
            const scaleFactor = originalDimensions.width / imageDimensions[puzzleImage].width; // 計算縮放因子
            originalDimensions = { 
                width: imageDimensions[puzzleImage].width * scaleFactor, 
                height: imageDimensions[puzzleImage].height * scaleFactor 
            }; // 更新尺寸
        } else if (puzzleImage === 'Konan') {
            piecesCount = 36; // 6x6 拼圖
            puzzleFolder = 'Puzzle_3'; // 更新資料夾
            const scaleFactor = originalDimensions.width / imageDimensions[puzzleImage].width; // 計算縮放因子
            originalDimensions = { 
                width: imageDimensions[puzzleImage].width * scaleFactor, 
                height: imageDimensions[puzzleImage].height * scaleFactor 
            }; // 更新尺寸
        } else {
            piecesCount = 36; // 預設為 6x6 拼圖
            puzzleFolder = 'Puzzle_2'; // 更新資料夾
            puzzleImage = 'AceofDiamond'; // 更新圖片名
            const scaleFactor = originalDimensions.width / imageDimensions[puzzleImage].width; // 計算縮放因子
            originalDimensions = { 
                width: imageDimensions[puzzleImage].width * scaleFactor, 
                height: imageDimensions[puzzleImage].height * scaleFactor 
            }; // 更新尺寸
        }
    }
    initializePuzzle(); // 重新初始化拼圖
}

// 添加滑鼠拖動功能
function addDragFunctionality(piece) {
    let startX, startY, initialX, initialY;

    piece.addEventListener("mousedown", (e) => {
        startX = e.clientX;
        startY = e.clientY;
        initialX = parseInt(piece.style.left, 10);
        initialY = parseInt(piece.style.top, 10);

        piece.style.cursor = "grabbing";

        document.addEventListener("mousemove", onMouseMove);
        document.addEventListener("mouseup", onMouseUp);
    });

    function onMouseMove(e) {
        const dx = e.clientX - startX;
        const dy = e.clientY - startY;
        piece.style.left = `${initialX + dx}px`;
        piece.style.top = `${initialY + dy}px`;
    }

    function onMouseUp() {
        piece.style.cursor = "grab";
        document.removeEventListener("mousemove", onMouseMove);
        document.removeEventListener("mouseup", onMouseUp);
        snapToGrid(piece);
        checkPuzzleCompletion();
    }
}

// 將拼圖塊對齊到網格
function snapToGrid(piece) {
    const x = parseInt(piece.style.left, 10);
    const y = parseInt(piece.style.top, 10);

    const gridSize = Math.sqrt(piecesCount);
    const gridX = Math.round(x / (originalDimensions.width / gridSize)) * (originalDimensions.width / gridSize);
    const gridY = Math.round(y / (originalDimensions.height / gridSize)) * (originalDimensions.height / gridSize);

    piece.style.left = `${gridX}px`;
    piece.style.top = `${gridY}px`;
}

// 完成拼圖檢查
function checkPuzzleCompletion() {
    const pieces = document.querySelectorAll(".puzzle-piece");
    let completed = true;

    pieces.forEach((piece) => {
        const index = parseInt(piece.dataset.index, 10) - 1;
        const gridSize = Math.sqrt(piecesCount);
        const correctX = (index % gridSize) * (originalDimensions.width / gridSize);
        const correctY = Math.floor(index / gridSize) * (originalDimensions.height / gridSize);

        const currentX = parseInt(piece.style.left, 10);
        const currentY = parseInt(piece.style.top, 10);

        // 輸出當前與正確位置的對比
        console.log(`Piece ${index + 1}: Current Position = (${currentX}, ${currentY}), Correct Position = (${correctX}, ${correctY})`);

        // 使用一個小的容忍範圍來判斷位置是否匹配
        const tolerance = 1; // 容忍範圍

        if (Math.abs(currentX - correctX) > tolerance || Math.abs(currentY - correctY) > tolerance) {
            completed = false;
        }
    });

    if (completed) {
        document.getElementById("puzzle-status").style.display = "block";

        // 顯示提示字
        const hintMessage = document.getElementById("hint-message-3");
        hintMessage.style.display = "block"; // 顯示提示信息
        
        // 添加淡入效果
        hintMessage.style.opacity = 0; // 初始化透明度
        hintMessage.style.transition = "opacity 0.5s ease"; // 過渡效果

        // 更新提示內容
        hintMessage.innerHTML = '恭喜你完成拼圖！今天的提示詞是: <span id="hint-word-3">' + document.getElementById("hint-word-3").textContent + '</span>。';

        // 顯示提示時淡入
        setTimeout(() => {
            hintMessage.style.opacity = 1; // 完全可見
        }, 10); // 確保淡入效果

        // 在一段時間後隱藏提示
        setTimeout(() => {
            hintMessage.style.opacity = 0; // 開始淡出
            setTimeout(() => {
                hintMessage.style.display = "none"; // 隱藏提示
            }, 500); // 等待淡出完成
        }, 3000); // 3秒後淡出
    }
}





// 圖片選擇功能
document.querySelectorAll('.selectable-image').forEach(image => {
    image.addEventListener('click', () => {
        puzzleImage = image.dataset.image; // 更新圖片名
        if (puzzleImage === 'InuYasha') {
            changePuzzleSize('5x5'); // 選擇 InuYasha 時設置為 5x5 拼圖
        } else {
            changePuzzleSize('6x6'); // 其他圖片設置為 6x6 拼圖
        }
    });
});


function shufflePuzzle() {
    initializePuzzle(); // 重新初始化拼圖
    document.getElementById("puzzle-status").style.display = "none"; // 隱藏完成訊息
}


// 初始化拼圖
initializePuzzle();










</script>




</body>
</html>
